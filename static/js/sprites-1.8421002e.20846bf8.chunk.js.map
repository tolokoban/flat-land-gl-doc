{"version":3,"sources":["view/button/button.tsx","view/button/index.ts","view/canvas/canvas.tsx","view/page/page.tsx","view/page/index.ts","App.tsx","serviceWorker.ts","index.tsx","../node_modules/@babel/runtime/regenerator/index.js","../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../node_modules/regenerator-runtime/runtime.js","page/tutorial/sprites-1/sprites-1.tsx","page/tutorial/sprites-1/sprites-1-code.md","page/tutorial/sprites-1/atlas.png","page/tutorial/sprites-1/background.png","../../flat-land-gl/lib/calc.js","../../flat-land-gl/lib/camera/camera.js","../../flat-land-gl/lib/camera/index.js","../../flat-land-gl/lib/camera/silly.js","../../flat-land-gl/lib/camera/cover-2d.js","../../flat-land-gl/lib/converter/string.js","../../flat-land-gl/lib/webgl/program.js","../../flat-land-gl/lib/painter/painter.js","../../flat-land-gl/lib/painter/background/background.js","../../flat-land-gl/lib/webgl/color.js","../../flat-land-gl/lib/painter/clear.js","../../flat-land-gl/lib/painter/sprites/virtual-sprite.js","../../flat-land-gl/lib/painter/sprites/quad.js","../../flat-land-gl/lib/painter/sprites/sprite.js","../../flat-land-gl/lib/painter/sprites/sprites.js","../../flat-land-gl/lib/painter/sprites/sprites.vert","../../flat-land-gl/lib/painter/sprites/sprites.frag","../../flat-land-gl/lib/painter/voronoi/voronoi.js","../../flat-land-gl/lib/painter/index.js","../../flat-land-gl/lib/painter/voronoi/voronoi.frag","../../flat-land-gl/lib/painter/voronoi/voronoi.vert","../../flat-land-gl/lib/atlas.js","../../flat-land-gl/lib/pointer.js","../../flat-land-gl/lib/webgl/resize.js","../../flat-land-gl/lib/scene.js","../../flat-land-gl/lib/index.js"],"names":["Button","handleClick","console","log","props","onClick","className","this","label","React","Component","Canvas","ref","createRef","canvas","current","init","Page","handleToggle","info","state","setState","visible","preContent","codeContent","postContent","join","window","history","back","title","onLoad","options","forceBlock","languages","App","href","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","module","exports","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","value","error","done","Promise","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","runtime","Op","Object","prototype","hasOwn","hasOwnProperty","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","GenStateSuspendedStart","method","GenStateExecuting","Error","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","type","GenStateSuspendedYield","makeInvokeMethod","obj","call","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","AsyncIterator","previousPromise","callInvokeWithMethodAndArg","invoke","result","__await","unwrapped","TypeError","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","length","i","constructor","displayName","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","async","iter","toString","keys","object","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","Function","newType","add","a","items","count","k","TYPES","item","spritesPainter","createSprite","extra","speed1","Math","random","speed2","x","y","w","h","atlas","atlases","sprites","z","width","height","u0","v0","u1","v1","originX","originY","scale","angle","scene","FlatLand","Scene","createAtlasesAsync","background","image","BackgroundAtlas","SpritesAtlas","camera","Camera","Cover2D","size","Painter","Sprites","backgroundPainter","Background","align","bol","corbeille","tasse","citron","croissant","framboise","noisette","the","update","onAnimation","time","radius","cos","sin","use","start","MODULO","FULL_TURN","COS","Float32Array","SIN","PI","clamp","v","min","max","getShaderIncludes","_this","cameraUniforms","glslUniforms","map","cameraFunction","glslFunction","Silly","_super","defineProperty","get","enumerable","configurable","setUniformValues","params","zoom","uniCameraInvertedScale","uniCameraScaleX","uniCameraScaleY","uniCameraX","uniCameraY","toFixed","prg","uniforms","invertedScale","castString","defaultValue","t","BPE","BYTES_PER_ELEMENT","Program","gl","_codes","includes","e_1","_a","codes","vert","parseInclude","frag","parseIncludes","freeze","_typesNamesLookup","lookup","toUpperCase","getTypesNamesLookup","shaderProgram","createProgram","program","vertShader","code","getShader","VERTEX_SHADER","getVertexShader","attachShader","fragShader","FRAGMENT_SHADER","getFragmentShader","linkProgram","useProgram","attribs","createAttributes","uniformsLocation","createUniformsLocation","_b","_c","name_1","e_1_1","return","getTypeName","typeId","bindAttribs","buffer","e_2","e_3","names","_i","that","bindBuffer","ARRAY_BUFFER","totalSize","names_1","names_1_1","name_2","attrib","n","String","e_2_1","offset","names_2","names_2_1","name_3","enableVertexAttribArray","vertexAttribPointer","FLOAT","e_3_1","setUniform","uniformsName","attribsCount","getProgramParameter","ACTIVE_ATTRIBUTES","index","getActiveAttrib","typeName","getSize","getAttribLocation","writable","FLOAT_VEC4","FLOAT_VEC3","FLOAT_VEC2","uniformsCount","ACTIVE_UNIFORMS","getActiveUniform","name_4","sanitizeUniformName","location_1","getUniformLocation","set","createUniformSetter","createUniformGetter","nameGL","nameJS","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","SAMPLER_2D","uniform1i","uniform1iv","uniform1f","uniform1fv","uniform2fv","uniform3fv","uniform4fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","split","line","trim","startsWith","pos","indexOf","includeName","substr","snippet","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","errorMessage","getShaderInfoLog","lines","unshift","RX_ERROR_MESSAGE","lastIndex","matcher","exec","lineNumber","Number","firstLine","lastLine","outputLines","geCodeSection","_programs","_scene","internalDestroy","initialize","shaders","fatal","message","deleteProgram","BackgroundPainter","buff","enable","DEPTH_TEST","activate","$uniTexture","drawArrays","TRIANGLE_STRIP","destroy","deleteBuffer","FRAG","getVert","createBuffer","bufferData","STATIC_DRAW","CODE_CSS_LENGTHS","RX_HEX_COLOR","Color","codeCSS","R","G","B","H","S","L","A","parse","isValid","test","CODE_CSS_LENGTHS_1","CODE_CSS_LENGTHS_1_1","len","normalize","stringify","luminance","luminanceStep","fromArrayRGB","rgb","newRGB","fromArrayRGBA","rgba","newRGBA","mix","color1","color2","alpha","beta","ramp","colors","newBlack","spacesCount","firstColorIndex","floor","translatedAlpha","newWhite","red","green","blue","color","toArrayRGB","toArrayRGBA","input","parseHexa","parseRGB","parseRGBA","parseHSL","hexa2","copy","newColor","hsl2rgb","chroma","abs","shift","rgb2hsl","delta","INV6","text","parseInt","INV15","INV255","m","RX_RGB","clamp01","RX_RGBA","parseFloat","RX_HSL","INV359","INV99","out","ClearPainter","_red","_green","_blue","_alpha","cssColor","clearColor","clear","COLOR_BUFFER_BIT","VirtualSprite","id","data","$index","_id","_data","_update","_destroy","Quad","_params","newParams","xTL","yTL","zTL","uTL","vTL","xTR","yTR","zTR","uTR","vTR","xBR","yBR","zBR","uBR","vBR","xBL","yBL","zBL","uBL","vBL","Sprite","xxA","yyA","xxB","yyB","xxC","yyC","xxD","yyD","xA","yA","xB","yB","xC","yC","xD","yD","C","BLOCK","NB_ELEMS","NB_CORNERS","CHUNK","globalID","SpritesPainter","_capacity","_dataVert","_sprites","sprite","_allocate","_deferedSpritesUpdate","lastSprite","_atlas","_camera","Map","createQuad","_allocateNewBlock","_buffElem","ELEMENT_ARRAY_BUFFER","createElements","DYNAMIC_DRAW","dataVert","_prg","_buffVert","drawElements","TRIANGLES","buffVert","buffElem","manageDeferedSpritesUpdates","_d","CORNER_B","CORNER_C","CORNER_D","capacity","dataElem","Uint16Array","b","c","d","randomArray","arr","Clear","Voronoi","VoronoiPainter","seeds","border","light","scaleX","scaleY","thickness","Atlas","_name","_ready","_width","_height","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","deleteTexture","unit","UNITS","TEXTURE0","TEXTURE1","TEXTURE2","TEXTURE3","TEXTURE4","TEXTURE5","TEXTURE6","TEXTURE7","activeTexture","refresh","load","loadImage","loadCanvas","url","img","Image","onload","texImage2D","RGBA","onerror","src","Pointer","_x","_y","_down","_downTime","_eventDown","_eventUp","onMouseMove","evt","computeCoords","clientX","clientY","onTouchMove","te","touches","onMouseDown","onDown","onTouchStart","onMouseUp","onUp","onTouchEnd","addEventListener","Date","now","pointerX","pointerY","rect","getBoundingClientRect","left","top","_resolution","resolution","devicePixelRatio","HTMLCanvasElement","displayWidth","clientWidth","displayHeight","clientHeight","viewport","ID","activePainters","isRendering","lastRenderingTime","requestAnimationFrame","clearDepth","DEPTH_BUFFER_BIT","depthFunc","GEQUAL","pointer","ex","_pointer","getContext","_gl","drawingBufferWidth","drawingBufferHeight","painters","painters_1","painters_1_1","getAtlas","createAtlas","sanitizedName","getNewName","createAtlasAsync","atlasNames","promises","atlasNames_1","atlasNames_1_1","atlasName","atlasParam","all","destroyAtlas","delete","has","IScene","Calc"],"mappings":"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","file":"static/js/sprites-1.8421002e.20846bf8.chunk.js","sourcesContent":["import React from \"react\"\n\nimport \"./button.css\"\n\ninterface IButtonProps {\n    label: string,\n    onClick: () => void\n}\n\nexport default class Button extends React.Component<IButtonProps, {}> {\n  private handleClick = () => {\n    console.log(\"Click!\")\n    this.props.onClick()\n  }\n\n  render() {\n    return (<button className=\"Button thm-ele-button thm-bgS\"\n                    onClick={this.handleClick}>{\n        this.props.label\n      }</button>)\n    }\n}\n","export { default } from './button'\n","import React from \"react\"\n\ninterface ICanvasProps {\n    init: (canvas: HTMLCanvasElement) => void\n}\n\nexport default class Canvas extends React.Component<ICanvasProps, {}> {\n    private readonly ref: React.RefObject<HTMLCanvasElement> = React.createRef();\n\n    componentDidMount() {\n        const canvas = this.ref.current\n        if (!canvas) return\n        this.props.init(canvas)\n    }\n\n    render() {\n        return (<canvas ref={this.ref} className=\"Canvas\"></canvas>)\n    }\n}\n","import React from \"react\"\n//import Icon from \"tfw/dist/view/icon\"\nimport Canvas from '../canvas'\nimport Markdown from 'markdown-to-jsx'\nimport { Highlight } from 'react-fast-highlight'\nimport Button from '../button'\nimport \"./page.css\"\n\ninterface TPageProps {\n    title: string,\n    preContent?: string,\n    codeContent?: string,\n    postContent?: string,\n    onLoad: (canvas: HTMLCanvasElement) => void\n}\ninterface TPageState {\n  visible: boolean\n}\n\nexport default class Page extends React.Component<TPageProps, TPageState> {\n  constructor( props: TPageProps ) {\n      super(props)\n      this.state = { visible: false }\n  }\n\n  private handleToggle = () => {\n    console.info(\"this.state=\", this.state);\n    this.setState({\n      visible: !this.state.visible\n    })\n  }\n\n  render() {\n    const { preContent, codeContent, postContent } = this.props\n    const classes = ['view-Page']\n\n    return (<div className={classes.join(' ')}>\n      <header className=\"thm-ele-nav thm-bgP\">\n        <Button label=\"back\" onClick={() => window.history.back()}/>\n        <div>{this.props.title}</div>\n        <Button label=\"doc.\" onClick={this.handleToggle}/>\n      </header>\n      <Canvas init={this.props.onLoad}/>\n      <div className={this.state.visible ? 'desc-show' : 'desc-hide'}>\n        {\n          preContent &&\n          <Markdown options={{ forceBlock: true }}>{preContent}</Markdown>\n        }\n        {\n          codeContent &&\n          <Highlight languages={['js']}>{\n            codeContent\n          }</Highlight>\n        }\n        {\n          postContent &&\n          <Markdown options={{ forceBlock: true }}>{postContent}</Markdown>\n        }\n      </div>\n    </div>)\n  }\n}\n","export { default } from './page'","import React from 'react';\nimport './App.css';\n\nconst App: React.FC = () => {\n    return (\n        <div className=\"App\">\n            <h1>Tutorials</h1>\n            <ul>\n                <li><a href=\"tutorial/clear.html\">Hello world!</a></li>\n                <li><a href=\"tutorial/background.html\">Scalable background</a></li>\n                <li><a href=\"tutorial/sprites-1.html\">Sprites</a></li>\n                <li><a href=\"tutorial/sprites-2.html\">Quads</a></li>\n                <li><a href=\"tutorial/voronoi.html\">Voronoi</a></li>\n            </ul>\n            <h1>Articles</h1>\n            <ul>\n                <li><a href=\"article/voronoi.html\">Voronoi</a></li>\n            </ul>\n    </div>\n    );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = require(\"regenerator-runtime\");\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nvar runtime = function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []); // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n    return generator;\n  }\n\n  exports.wrap = wrap; // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n\n  function tryCatch(fn, obj, arg) {\n    try {\n      return {\n        type: \"normal\",\n        arg: fn.call(obj, arg)\n      };\n    } catch (err) {\n      return {\n        type: \"throw\",\n        arg: err\n      };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\"; // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n\n  var ContinueSentinel = {}; // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n\n  function Generator() {}\n\n  function GeneratorFunction() {}\n\n  function GeneratorFunctionPrototype() {} // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n\n\n  var IteratorPrototype = {};\n\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n\n  if (NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] = GeneratorFunction.displayName = \"GeneratorFunction\"; // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      prototype[method] = function (arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  exports.isGeneratorFunction = function (genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor ? ctor === GeneratorFunction || // For the native GeneratorFunction constructor, the best we can\n    // do is to check its .name property.\n    (ctor.displayName || ctor.name) === \"GeneratorFunction\" : false;\n  };\n\n  exports.mark = function (genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  }; // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n\n\n  exports.awrap = function (arg) {\n    return {\n      __await: arg\n    };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n\n        if (value && typeof value === \"object\" && hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function (value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function (err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function (unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function (error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function (resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise = // If enqueue has been called before, then we want to wait until\n      // all previous Promises have been resolved before calling invoke,\n      // so that results are always delivered in the correct order. If\n      // enqueue has not been called before, then it is important to\n      // call invoke immediately, without waiting on a callback to fire,\n      // so that the async generator function has the opportunity to do\n      // any necessary setup in a predictable way. This predictability\n      // is why the Promise constructor synchronously invokes its\n      // executor callback, and why async functions synchronously\n      // execute code before the first await. Since we implement simple\n      // async functions in terms of async generators, it is especially\n      // important to get this right, even though it requires care.\n      previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, // Avoid propagating failures to Promises returned by later\n      // invocations of the iterator.\n      callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n    } // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n\n\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n\n  exports.AsyncIterator = AsyncIterator; // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n\n  exports.async = function (innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList));\n    return exports.isGeneratorFunction(outerFn) ? iter // If outerFn is a generator, return the full iterator.\n    : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        } // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n\n\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n        var record = tryCatch(innerFn, self, context);\n\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done ? GenStateCompleted : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted; // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  } // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n\n\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (!info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value; // Resume execution at the desired location (see delegateYield).\n\n      context.next = delegate.nextLoc; // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    } // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n\n\n    context.delegate = null;\n    return ContinueSentinel;\n  } // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n\n\n  defineIteratorMethods(Gp);\n  Gp[toStringTagSymbol] = \"Generator\"; // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n\n  Gp[iteratorSymbol] = function () {\n    return this;\n  };\n\n  Gp.toString = function () {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = {\n      tryLoc: locs[0]\n    };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function (object) {\n    var keys = [];\n\n    for (var key in object) {\n      keys.push(key);\n    }\n\n    keys.reverse(); // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      } // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n\n\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1,\n            next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n          return next;\n        };\n\n        return next.next = next;\n      }\n    } // Return an iterator with no values.\n\n\n    return {\n      next: doneResult\n    };\n  }\n\n  exports.values = values;\n\n  function doneResult() {\n    return {\n      value: undefined,\n      done: true\n    };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n    reset: function reset(skipTempReset) {\n      this.prev = 0;\n      this.next = 0; // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n      this.method = \"next\";\n      this.arg = undefined;\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" && hasOwn.call(this, name) && !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n    stop: function stop() {\n      this.done = true;\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n    dispatchException: function dispatchException(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry && (type === \"break\" || type === \"continue\") && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n    complete: function complete(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" || record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n\n          return thrown;\n        }\n      } // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n\n\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  }; // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n\n  return exports;\n}( // If this script is executing as a CommonJS module, use module.exports\n// as the regeneratorRuntime namespace. Otherwise create a new empty\n// object. Either way, the resulting object will be used to initialize\n// the regeneratorRuntime variable at the top of this file.\ntypeof module === \"object\" ? module.exports : {});\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport FlatLand from 'flat-land-gl'\nimport codeContent from './sprites-1-code.md'\nimport SpritesAtlas from './atlas.png'\nimport BackgroundAtlas from './background.png'\nimport Page from '../../../view/page'\n\nReactDOM.render(\n  <Page\n    title=\"Sprites in motion\"\n    codeContent={codeContent}\n    onLoad={init}/>,\n  document.getElementById('root')\n)\n\nasync function init(canvas: HTMLCanvasElement) {\n    const scene = new FlatLand.Scene(canvas)\n    const atlases = await scene.createAtlasesAsync({\n        background: { image: BackgroundAtlas },\n        sprites: { image: SpritesAtlas },\n    })\n    const camera = new FlatLand.Camera.Cover2D({ size: 1024 })\n    const spritesPainter = new FlatLand.Painter.Sprites({\n        camera,\n        atlas: atlases.sprites\n    })\n    const backgroundPainter = new FlatLand.Painter.Background({\n        atlas: atlases.background,\n        align: \"B\"\n    })\n\n    function newType(x: number, y: number, w: number, h: number) {\n        const atlas = atlases.sprites\n        return {\n            x: 0,\n            y: 0,\n            z: Math.random(),\n            width: w,\n            height: h,\n            u0: x / atlas.width,\n            v0: y / atlas.height,\n            u1: (x + w) / atlas.width,\n            v1: (y + h) / atlas.height,\n            originX: w / 2,\n            originY: h / 2,\n            scale: 1,\n            angle: 0\n        }\n    }\n    const TYPES: {[key: string]: any} = {\n        bol: newType(0, 0, 542, 318),\n        corbeille: newType(0, 320, 402, 524),\n        tasse: newType(401, 467, 122, 119),\n        citron: newType(405, 675, 117, 110),\n        croissant: newType(415, 785, 104, 72),\n        framboise: newType(400, 617, 61, 58),\n        noisette: newType(462, 589, 61, 85),\n        the: newType(402, 316, 124, 149)\n    }\n\n    function add(items: any[], name: string, count: number = 1) {\n        for (let k=0 ; k<count ; k++) {\n            const type = TYPES[name]\n            const item = spritesPainter.createSprite(type)\n            item.extra.speed1 = (1 + Math.random()) * 0.001\n            item.extra.speed2 = (1 + Math.random()) * 0.001\n            items.push(item)\n        }\n    }\n\n    const items: any[] = []\n    add(items, \"bol\")\n    items[0].update({\n        x: 0, y: 0, z: 0,\n        width: 200, height: 200\n    })\n\n    add(items, \"corbeille\")\n    add(items, \"tasse\", 12)\n    add(items, \"citron\", 17)\n    add(items, \"croissant\", 23)\n    add(items, \"framboise\", 47)\n    add(items, \"noisette\", 20)\n    add(items, \"the\", 10)\n\n    scene.onAnimation = (time: number) => {\n        for (let k=0 ; k<items.length ; k++) {\n            const item = items[k]\n            const speed1 = item.extra.speed1\n            const speed2 = item.extra.speed2\n            const radius = 250 + Math.cos(time * speed1) * 50\n            const angle = (time + 54321) * speed2\n            const x = radius * Math.cos(angle)\n            const y = radius * Math.sin(angle)\n\n            item.update({ x, y, scale: .75 + 0.25 * Math.sin(time * speed2) })\n        }\n    }\n    scene.use([ spritesPainter, backgroundPainter ])\n    scene.start()\n}\n","export default \"const scene = new FlatLand.Scene(canvas)\\nconst atlas = scene.createAtlas({\\n    image: bowlAtlas\\n})\\nconst spritesPainter = new FlatLand.Painter.Sprites({\\n    atlas\\n})\\nconst bowl = spritesPainter.createSprite({\\n    x: 500, y: 500\\n})\\nscene.onAnimation = time => {\\n  const angle = time * 2\\n  const x = 512 + 200 * Math.cos(angle)\\n  const y = 512 + 200 * Math.sin(angle)\\n  bowl.update({ x, y, angle })\\n}\\nscene.use([ spritesPainter ])\\nscene.start()\\n\"","module.exports = __webpack_public_path__ + \"static/media/atlas.36c1c081.png\";","module.exports = __webpack_public_path__ + \"static/media/background.0935ef34.png\";","// tslint:disable:no-bitwise\nvar FULL_TURN = 4096;\nvar MODULO = FULL_TURN - 1;\nvar HALF_TURN = 2048;\nvar COS = new Float32Array(FULL_TURN);\nvar SIN = new Float32Array(FULL_TURN); // Prepare acceleration table for COS and SIN.\n\nfor (var i = 0; i < FULL_TURN; i++) {\n  var angle = Math.PI * i / HALF_TURN;\n  COS[i] = Math.cos(angle);\n  SIN[i] = Math.sin(angle);\n}\n\nexport default {\n  cos: cos,\n  sin: sin,\n  clamp: clamp\n};\n/**\n * Fast cosine.\n * Angle is define between 0 and 4095.\n * * PI/2  <=>  1023\n * * PI  <=>  2047\n * * 3*PI/2  <=>  3071\n */\n\nfunction cos(angle) {\n  return COS[(angle | 0) & MODULO];\n}\n/**\n * Fast sine.\n * Angle is define between 0 and 4095.\n * * PI/2  <=>  1023\n * * PI  <=>  2047\n * * 3*PI/2  <=>  3071\n */\n\n\nfunction sin(angle) {\n  return SIN[(angle | 0) & MODULO];\n}\n/**\n * Force a number to stay between two bounds.\n */\n\n\nfunction clamp(v, min, max) {\n  if (min === void 0) {\n    min = 0;\n  }\n\n  if (max === void 0) {\n    max = 1;\n  }\n\n  if (v < min) return min;\n  if (v > max) return max;\n  return v;\n}","/**\n * The Camera is responsible of transforming World coordinates into Screen coordinates.\n * To do this, the Camera defines the following Vertex Shader function:\n *\n * ```glsl\n * vec4 worldPointToScreen(vec3 point)\n * ```\n *\n * And it can work only if the following attributes are defined:\n *\n * ```glsl\n * attribute float uniCanvasWidth;\n * attribute float uniCanvasHeight;\n * ```\n *\n * Because there is a lot of different cameras, they can need extra attributes.\n * That's why Camera provides two readonly properties:\n * * `glslUniforms`:\n * * `glslFunction`\n */\nvar Camera =\n/** @class */\nfunction () {\n  function Camera() {}\n\n  Camera.prototype.getShaderIncludes = function () {\n    var _this = this;\n\n    return {\n      cameraUniforms: Object.keys(this.glslUniforms).map(function (key) {\n        return \"uniform \" + _this.glslUniforms[key] + \" \" + key + \";\\n\";\n      }).join(\"\"),\n      cameraFunction: this.glslFunction\n    };\n  };\n\n  return Camera;\n}();\n\nexport default Camera;","import Silly from './silly';\nimport Cover2D from './cover-2d';\nexport default {\n  Silly: Silly,\n  Cover2D: Cover2D\n};","import { __extends } from \"tslib\";\nimport Camera from \"./camera\";\n/**\n * This Camera is silly because it does not transform coordinates.\n */\n\nvar Silly =\n/** @class */\nfunction (_super) {\n  __extends(Silly, _super);\n\n  function Silly() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(Silly.prototype, \"glslUniforms\", {\n    get: function get() {\n      return {};\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Silly.prototype, \"glslFunction\", {\n    get: function get() {\n      return \"vec4 worldPointToScreen(vec3 point) {\\n    return vec4(point, 1.0);\\n}\";\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Silly.prototype.setUniformValues = function () {};\n\n  return Silly;\n}(Camera);\n\nexport default Silly;","import { __assign, __extends } from \"tslib\";\nimport Camera from \"./camera\";\n/**\n * The Camera is responsible of transforming World coordinates into Screen coordinates.\n * To do this, the Camera defines the following Vertex Shader function:\n *\n * ```glsl\n * vec4 worldPointToScreen(vec3 point)\n * ```\n *\n * And it can work only if the following attributes are defined:\n *\n * ```glsl\n * attribute float uniCanvasWidth;\n * attribute float uniCanvasHeight;\n * ```\n *\n * Because there is a lot of different cameras, they can need extra attributes.\n * That's why Camera provides two readonly properties:\n * * `glslUniforms`:\n * * `glslFunction`\n */\n\nvar Cover2D =\n/** @class */\nfunction (_super) {\n  __extends(Cover2D, _super);\n\n  function Cover2D(params) {\n    var _this = _super.call(this) || this;\n\n    _this.zoom = 1;\n    _this.x = 0;\n    _this.y = 0;\n    _this.params = __assign({\n      size: 1024\n    }, params);\n    return _this;\n  }\n\n  Object.defineProperty(Cover2D.prototype, \"glslUniforms\", {\n    get: function get() {\n      return {\n        uniCameraInvertedScale: \"float\",\n        uniCameraScaleX: \"float\",\n        uniCameraScaleY: \"float\",\n        uniCameraX: \"float\",\n        uniCameraY: \"float\"\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Cover2D.prototype, \"glslFunction\", {\n    get: function get() {\n      return \"vec4 worldPointToScreen(vec3 point) {\\n    return vec4((point.x - uniCameraX) * uniCameraScaleX,\\n                (point.y - uniCameraY) * uniCameraScaleY,\\n                point.z,\\n                /*uniCameraInvertedScale **/ \" + (this.params.size / 2).toFixed(1) + \");\\n}\";\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * @param prg - Attributes have to be set in this Program.\n   * @param width - Canvas Width.\n   * @param height - Canvas Height.\n   * @param time - Time of the rendered frame in milliseconds.\n   */\n\n  Cover2D.prototype.setUniformValues = function (prg, width, height) {\n    if (width > height) {\n      // Landscape.\n      prg.uniforms.uniCameraScaleX = 1;\n      prg.uniforms.uniCameraScaleY = width / height;\n    } else {\n      // Portrait.\n      prg.uniforms.uniCameraScaleX = height / width;\n      prg.uniforms.uniCameraScaleY = 1;\n    }\n\n    prg.uniforms.uniCameraX = this.x;\n    prg.uniforms.uniCameraY = this.y;\n    var zoom = this.zoom;\n\n    if (zoom === 0) {\n      prg.uniforms.uniCameraInvertedScale = 1;\n    } else {\n      var invertedScale = 1 / zoom;\n      prg.uniforms.uniCameraInvertedScale = invertedScale;\n    }\n  };\n\n  return Cover2D;\n}(Camera);\n\nexport default Cover2D;","// tslint:disable:no-any\n// tslint:disable:no-unsafe-any\nexport default function castString(value, defaultValue) {\n  if (defaultValue === void 0) {\n    defaultValue = '';\n  }\n\n  var t = typeof value;\n\n  if (t === 'number' && !isNaN(value)) {\n    return \"\" + value;\n  }\n\n  if (t === 'string') {\n    return value;\n  }\n\n  return defaultValue;\n}","import { __values } from \"tslib\";\nvar BPE = Float32Array.BYTES_PER_ELEMENT;\nvar DIM1 = 1;\nvar DIM2 = 2;\nvar DIM3 = 3;\nvar DIM4 = 4;\n/**\n * Creating  a  WebGL  program  for shaders  is  painful.  This  class\n * simplifies the process.\n *\n * @class Program\n *\n * Object properties starting with `$` are WebGL uniforms or attributes.\n * Uniforms behave as expected: you can read/write a value.\n * Attributes when read, return the location. And when written, enable/disabled\n * this attribute. So you read integers and writte booleans.\n *\n * @param gl - WebGL context.\n * @param codes  - Object  with two  mandatory attributes:  `vert` for\n * vertex shader and `frag` for fragment shader.\n * @param  includes  -  (optional)  If  defined,  the  `#include  foo`\n * directives  of  shaders   will  be  replaced  by   the  content  of\n * `includes.foo`.\n */\n\nvar Program =\n/** @class */\nfunction () {\n  function Program(gl, _codes, includes) {\n    var e_1, _a;\n\n    if (includes === void 0) {\n      includes = {};\n    }\n\n    var codes = parseIncludes(_codes, includes);\n    this.gl = gl;\n    Object.freeze(this.gl);\n    this.BPE = BPE;\n    Object.freeze(this.BPE);\n    this._typesNamesLookup = getTypesNamesLookup(gl);\n    var shaderProgram = gl.createProgram();\n\n    if (!shaderProgram) {\n      throw Error('Unable to create WebGLProgram!');\n    }\n\n    this.program = shaderProgram;\n    var vertShader = getVertexShader(gl, codes.vert);\n    gl.attachShader(shaderProgram, vertShader);\n    var fragShader = getFragmentShader(gl, codes.frag);\n    gl.attachShader(shaderProgram, fragShader);\n    gl.linkProgram(shaderProgram);\n\n    this.use = function () {\n      gl.useProgram(shaderProgram);\n    };\n\n    this.attribs = this.createAttributes();\n    this.uniforms = {};\n    this.uniformsLocation = this.createUniformsLocation();\n\n    try {\n      for (var _b = __values(Object.keys(codes)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var name_1 = _c.value;\n        console.log(\">>> Shader: \", name_1);\n        console.log(codes[name_1]);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  }\n\n  Program.prototype.use = function () {\n    this.gl.useProgram(this.program);\n  };\n\n  Program.prototype.getTypeName = function (typeId) {\n    return this._typesNamesLookup[typeId];\n  };\n\n  Program.prototype.bindAttribs = function (buffer) {\n    var e_2, _a, e_3, _b;\n\n    var names = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      names[_i - 1] = arguments[_i];\n    }\n\n    var that = this;\n    var gl = this.gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    var totalSize = 0;\n\n    try {\n      for (var names_1 = __values(names), names_1_1 = names_1.next(); !names_1_1.done; names_1_1 = names_1.next()) {\n        var name_2 = names_1_1.value;\n        var attrib = that.attribs[name_2];\n\n        if (!attrib) {\n          throw Error(\"Cannot find attribute \\\"\" + name_2 + \"!\\nIt may be not active because unused in the shader.\\nAvailable attributes are: \" + Object.keys(that.attribs).map(function (n) {\n            return \"\\\"\" + n + \"\\\"\";\n          }).join(', ') + \" (\" + String(that.attribs.length) + \")\");\n        }\n\n        totalSize += attrib.size * attrib.length * BPE;\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (names_1_1 && !names_1_1.done && (_a = names_1.return)) _a.call(names_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var offset = 0;\n\n    try {\n      for (var names_2 = __values(names), names_2_1 = names_2.next(); !names_2_1.done; names_2_1 = names_2.next()) {\n        var name_3 = names_2_1.value;\n        var attrib = that.attribs[name_3];\n        gl.enableVertexAttribArray(attrib.location);\n        gl.vertexAttribPointer(attrib.location, attrib.size * attrib.length, gl.FLOAT, false, // No normalisation.\n        totalSize, offset);\n        offset += attrib.size * attrib.length * BPE;\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (names_2_1 && !names_2_1.done && (_b = names_2.return)) _b.call(names_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n  };\n\n  Program.prototype.setUniform = function (name, value) {\n    var _a = this,\n        uniforms = _a.uniforms,\n        uniformsLocation = _a.uniformsLocation;\n\n    if (typeof uniformsLocation[name] === 'undefined') {\n      console.error(\"Uniform \\\"\" + name + \"\\\" does not exist in this WebGL Program!\");\n      var uniformsName = Object.keys(uniformsLocation);\n\n      if (uniformsName.length === 0) {\n        console.error(\"Actually, this program has no uniform at all.\");\n      } else {\n        console.error(\"Available uniforms are:\", uniformsName.join(\", \"));\n      }\n\n      throw Error(\"Uniform \\\"\" + name + \"\\\" was ot found!\");\n    }\n\n    uniforms[name] = value;\n  };\n\n  Program.prototype.createAttributes = function () {\n    var _a = this,\n        gl = _a.gl,\n        program = _a.program;\n\n    var attribs = {};\n    var attribsCount = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n\n    for (var index = 0; index < attribsCount; index++) {\n      var item = gl.getActiveAttrib(program, index);\n\n      if (!item) {\n        continue;\n      }\n\n      item.typeName = this.getTypeName(item.type);\n      item.length = this.getSize(gl, item);\n      item.location = gl.getAttribLocation(program, item.name);\n      attribs[item.name] = item;\n      Object.defineProperty(this, \"\" + item.name, {\n        value: item.location,\n        writable: false,\n        enumerable: true,\n        configurable: false\n      });\n    }\n\n    return attribs;\n  };\n\n  Program.prototype.getSize = function (gl, item) {\n    switch (item.type) {\n      case gl.FLOAT_VEC4:\n        return DIM4;\n\n      case gl.FLOAT_VEC3:\n        return DIM3;\n\n      case gl.FLOAT_VEC2:\n        return DIM2;\n\n      case gl.FLOAT:\n        return DIM1;\n\n      default:\n        throw Error(\"[webgl.program:getSize] I don't know the size of the attribute \\\"\" + item.name + \"\\\" because I don't know the type \\\"\" + this.getTypeName(item.type) + \"\\\"!\");\n    }\n  };\n\n  Program.prototype.createUniformsLocation = function () {\n    var _a = this,\n        gl = _a.gl,\n        program = _a.program,\n        uniforms = _a.uniforms;\n\n    var uniformsLocation = {};\n    var uniformsCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n\n    for (var index = 0; index < uniformsCount; index++) {\n      var item = gl.getActiveUniform(program, index);\n\n      if (!item) {\n        continue;\n      }\n\n      var name_4 = sanitizeUniformName(item.name);\n      var location_1 = gl.getUniformLocation(program, item.name);\n\n      if (!location_1) {\n        continue;\n      }\n\n      uniformsLocation[name_4] = location_1;\n      Object.defineProperty(uniforms, \"\" + name_4, {\n        set: this.createUniformSetter(item, uniformsLocation[name_4], this._typesNamesLookup),\n        get: this.createUniformGetter(item),\n        enumerable: true,\n        configurable: false\n      });\n    }\n\n    return uniformsLocation;\n  };\n\n  Program.prototype.createUniformSetter = function (item, nameGL, lookup) {\n    var gl = this.gl;\n    var name = sanitizeUniformName(item.name);\n    var nameJS = \"_\" + name;\n\n    switch (item.type) {\n      case gl.BYTE:\n      case gl.UNSIGNED_BYTE:\n      case gl.SHORT:\n      case gl.UNSIGNED_SHORT:\n      case gl.INT:\n      case gl.UNSIGNED_INT:\n      case gl.SAMPLER_2D:\n        // For textures, we specify the texture unit.\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniform1i(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          return function (v) {\n            gl.uniform1iv(nameGL, v);\n            this[nameJS] = v;\n          };\n        }\n\n      case gl.FLOAT:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniform1f(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          return function (v) {\n            gl.uniform1fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        }\n\n      case gl.FLOAT_VEC2:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniform2fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform \\\"\" + item.name + \"\\\"!\");\n        }\n\n      case gl.FLOAT_VEC3:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniform3fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform \\\"\" + item.name + \"\\\"!\");\n        }\n\n      case gl.FLOAT_VEC4:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniform4fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform \\\"\" + item.name + \"\\\"!\");\n        }\n\n      case gl.FLOAT_MAT3:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniformMatrix3fv(nameGL, false, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform \\\"\" + item.name + \"\\\"!\");\n        }\n\n      case gl.FLOAT_MAT4:\n        if (item.size === 1) {\n          return function (v) {\n            gl.uniformMatrix4fv(nameGL, false, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform \\\"\" + item.name + \"\\\"!\");\n        }\n\n      default:\n        throw Error(\"[webgl.program.createWriter] Don't know how to deal with uniform \\\"\" + item.name + \"\\\" of type \" + lookup[item.type] + \"!\");\n    }\n  };\n\n  Program.prototype.createUniformGetter = function (item) {\n    var name = \"_\" + item.name;\n    return function () {\n      return this[name];\n    };\n  };\n\n  return Program;\n}();\n\nexport default Program;\n/**\n * This is a preprocessor for shaders.\n * Directives  `#include`  will be  replaced  by  the content  of  the\n * correspondent attribute in `includes`.\n */\n\nfunction parseIncludes(codes, includes) {\n  return {\n    vert: parseInclude(codes.vert, includes),\n    frag: parseInclude(codes.frag, includes)\n  };\n}\n\nfunction parseInclude(code, includes) {\n  return code.split('\\n').map(function (line) {\n    if (!line.trim().startsWith('#include')) {\n      return line;\n    }\n\n    var pos = line.indexOf('#include') + '#include'.length;\n    var includeName = line.substr(pos).trim(); // We accept all this systaxes:\n    // #include foo\n    // #include 'foo'\n    // #include <foo>\n    // #include \"foo\"\n\n    if ('\\'<\"'.indexOf(includeName.charAt(0)) > -1) {\n      includeName = includeName.substr(1, includeName.length - '<>'.length);\n    }\n\n    var snippet = includes[includeName];\n\n    if (typeof snippet !== 'string') {\n      console.error(\"Include <\" + includeName + \"> not found in \", includes);\n      throw Error(\"Include not found in shader: \" + includeName);\n    }\n\n    return snippet;\n  }).join('\\n');\n}\n\nfunction getShader(type, gl, code) {\n  if (type !== gl.VERTEX_SHADER && type !== gl.FRAGMENT_SHADER) {\n    throw Error('Type must be VERTEX_SHADER or FRAGMENT_SHADER!');\n  }\n\n  var shader = gl.createShader(type);\n\n  if (!shader) {\n    throw Error(\"Unable to create a \" + (type === gl.VERTEX_SHADER ? 'VERTEX' : 'FRAGMENT') + \" shader!\");\n  }\n\n  gl.shaderSource(shader, code);\n  gl.compileShader(shader);\n\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    var errorMessage = gl.getShaderInfoLog(shader) || \"NULL\";\n    console.error(\"An error occurred compiling the shader: \" + errorMessage); // tslint:disable-next-line:no-console\n\n    console.info(geCodeSection(code, errorMessage)); // tslint:disable-next-line:no-console\n\n    throw Error(\"Unable to create a \" + (type === gl.VERTEX_SHADER ? 'VERTEX' : 'FRAGMENT') + \" shader!\");\n  }\n\n  return shader;\n}\n\nfunction getFragmentShader(gl, code) {\n  return getShader(gl.FRAGMENT_SHADER, gl, code);\n}\n\nfunction getVertexShader(gl, code) {\n  return getShader(gl.VERTEX_SHADER, gl, code);\n}\n\nfunction getTypesNamesLookup(gl) {\n  var lookup = {};\n\n  for (var k in gl) {\n    if (k !== k.toUpperCase()) {\n      continue;\n    }\n\n    var v = gl[k];\n\n    if (typeof v === 'number') {\n      lookup[v] = k;\n    }\n  }\n\n  return lookup;\n}\n/**\n * For arrays, uniform names can be like this: \"lights[0]\".\n * This function will remove the \"[0]\" if it exist.\n */\n\n\nfunction sanitizeUniformName(name) {\n  var pos = name.indexOf(\"[\");\n  if (pos === -1) return name;\n  return name.substr(0, pos);\n}\n\nvar RX_ERROR_MESSAGE = /ERROR: ([0-9]+):([0-9]+):/g;\n/**\n * Return a portion of the code that is two lines before the error and two lines after.\n */\n\nfunction geCodeSection(code, errorMessage) {\n  var lines = code.split(/\\n\\r?/);\n  lines.unshift(\"\"); // Because lines numbers start at 1\n\n  RX_ERROR_MESSAGE.lastIndex = -1; // Reinit RegExp\n\n  var matcher = RX_ERROR_MESSAGE.exec(errorMessage);\n\n  if (!matcher) {\n    return code;\n  }\n\n  var lineNumber = Number(matcher[2]);\n  var firstLine = Math.max(1, lineNumber - 2);\n  var lastLine = Math.min(lines.length - 1, lineNumber + 2);\n  var outputLines = [];\n\n  for (var n = firstLine; n <= lastLine; n++) {\n    outputLines.push(n + \":    \" + lines[n]);\n  }\n\n  return outputLines.join(\"\\n\");\n}","import { __values } from \"tslib\";\nimport Program from '../webgl/program';\n\nvar Painter =\n/** @class */\nfunction () {\n  function Painter() {\n    this._programs = [];\n    this._scene = null;\n  }\n\n  Object.defineProperty(Painter.prototype, \"scene\", {\n    get: function get() {\n      return this._scene;\n    },\n    set: function set(scene) {\n      if (scene === this._scene) {\n        return;\n      }\n\n      if (this._scene) {\n        this.internalDestroy(this._scene);\n      }\n\n      this._scene = scene;\n\n      if (scene) {\n        this.initialize(scene);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Painter.prototype.createProgram = function (shaders, includes) {\n    if (includes === void 0) {\n      includes = {};\n    }\n\n    var scene = this._scene;\n\n    if (!scene) {\n      throw Error('This painter has no scene!\\ncreateProfram() should only be called from initialize().');\n    }\n\n    var prg = new Program(scene.gl, shaders, includes);\n\n    this._programs.push(prg);\n\n    return prg;\n  };\n\n  Painter.prototype.fatal = function (message) {\n    console.error(\"Fatal error in Painter:\", message);\n    return new Error(message);\n  };\n\n  Painter.prototype.internalDestroy = function (scene) {\n    var e_1, _a;\n\n    var gl = scene.gl;\n\n    try {\n      for (var _b = __values(this._programs), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var prg = _c.value;\n        gl.deleteProgram(prg);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  return Painter;\n}();\n\nexport default Painter;","/**\n * Background the screen by filling it with an image that covers it entirely.\n */\nimport { __extends } from \"tslib\";\nimport castString from '../../converter/string';\nimport Painter from '../painter';\nvar NB_VERTICES_IN_SQUARE = 4;\n\nvar BackgroundPainter =\n/** @class */\nfunction (_super) {\n  __extends(BackgroundPainter, _super);\n  /**\n   * params: { atlas, align }\n   * - align: if undefined, the background will be centered.\n   *          \"R\" means that the Right edge of the background is always visible.\n   *          \"L\" means the same for Left.\n   *          \"T\" for Top.\n   *          \"B\" for \"Bottom\".\n   */\n\n\n  function BackgroundPainter(params) {\n    var _this = _super.call(this) || this;\n\n    _this.params = params;\n    return _this;\n  }\n\n  BackgroundPainter.prototype.render = function () {\n    var _a = this,\n        scene = _a.scene,\n        prg = _a.prg,\n        atlas = _a.atlas,\n        buff = _a.buff;\n\n    if (!scene || !prg || !atlas || !buff) {\n      return;\n    }\n\n    var gl = scene.gl;\n    gl.enable(gl.DEPTH_TEST);\n    prg.use();\n    atlas.activate();\n    var uniforms = prg;\n    uniforms.$uniTexture = 0;\n    prg.setUniform('uniAspectRatio', scene.width / scene.height);\n    prg.bindAttribs(buff, 'attXY');\n    gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, NB_VERTICES_IN_SQUARE);\n  };\n\n  BackgroundPainter.prototype.destroy = function (scene) {\n    var gl = scene.gl;\n    var buff = this.buff;\n\n    if (!buff) {\n      return;\n    }\n\n    gl.deleteBuffer(buff);\n  };\n\n  BackgroundPainter.prototype.initialize = function (scene) {\n    var params = this.params;\n    var atlas = params.atlas;\n    this.atlas = atlas;\n    this.prg = this.createProgram({\n      frag: FRAG,\n      vert: getVert(castString(params.align).toUpperCase())\n    });\n    var gl = scene.gl;\n    var buff = gl.createBuffer();\n\n    if (!buff) {\n      throw this.fatal('Not enough memory to create an array buffer!');\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n    this.buff = buff;\n  };\n\n  return BackgroundPainter;\n}(Painter);\n\nexport default BackgroundPainter;\n\nfunction getVert(align) {\n  var x = '';\n  var y = '';\n\n  if (align.indexOf('B') !== -1) {\n    y = 'location.y -= uniAspectRatio - 1.0;';\n  } else if (align.indexOf('T') !== -1) {\n    y = 'location.y += uniAspectRatio - 1.0;';\n  }\n\n  if (align.indexOf('R') !== -1) {\n    x = 'location.x -= 1.0 / uniAspectRatio - 1.0;';\n  } else if (align.indexOf('L') !== -1) {\n    x = 'location.x += 1.0 / uniAspectRatio - 1.0;';\n  }\n\n  return \"uniform float uniAspectRatio;\\nattribute vec2 attXY;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  varUV = attXY;\\n  vec2 location = 2.0 * (attXY - vec2(0.5, 0.5));\\n\\n  if (uniAspectRatio > 1.0) {\\n    location.y *= uniAspectRatio;\" + y + \"\\n  } else {\\n    location.x /= uniAspectRatio;\" + x + \"\\n  }\\n\\n  gl_Position = vec4(location.x, -location.y, -1.0, 1.0);\\n}\";\n}\n\nvar FRAG = \"precision mediump float;\\nuniform sampler2D uniTexture;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  vec4 color = texture2D( uniTexture, varUV );\\n  gl_FragColor = color;\\n}\";","// tslint:disable:no-magic-numbers\n// tslint:disable:ban\nimport { __read, __values } from \"tslib\";\n/**\n * Fast color manipulations.\n * Attributes R  (red), G  (green), B  (blue), A  (alpha), H  (hue), S\n * (saturation), and L (luminance) are all floats between 0 and 1.\n */\n\nvar CODE_CSS_LENGTHS = ['#RGB'.length, '#RGBA'.length, '#RRGGBB'.length, '#RRGGBBAA'.length];\nvar RX_HEX_COLOR = /^#[0-9A-F]+$/gi;\nvar LUMINANCE_THRESHOLD = 0.6;\n\nvar Color =\n/** @class */\nfunction () {\n  function Color(codeCSS) {\n    if (codeCSS === void 0) {\n      codeCSS = '#000000';\n    }\n\n    this.R = 0;\n    this.G = 0;\n    this.B = 0;\n    this.H = 0;\n    this.S = 0;\n    this.L = 0;\n    this.A = 1;\n    this.parse(codeCSS);\n  }\n  /**\n   * A code CSS is valid if it starts with a '#' and has a length of 3, 4, 6 or 8.\n   */\n\n\n  Color.isValid = function (codeCSS) {\n    var e_1, _a;\n\n    RX_HEX_COLOR.lastIndex = -1;\n\n    if (!RX_HEX_COLOR.test(codeCSS)) {\n      return false;\n    }\n\n    try {\n      for (var CODE_CSS_LENGTHS_1 = __values(CODE_CSS_LENGTHS), CODE_CSS_LENGTHS_1_1 = CODE_CSS_LENGTHS_1.next(); !CODE_CSS_LENGTHS_1_1.done; CODE_CSS_LENGTHS_1_1 = CODE_CSS_LENGTHS_1.next()) {\n        var len = CODE_CSS_LENGTHS_1_1.value;\n\n        if (codeCSS.length === len) {\n          return true;\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (CODE_CSS_LENGTHS_1_1 && !CODE_CSS_LENGTHS_1_1.done && (_a = CODE_CSS_LENGTHS_1.return)) _a.call(CODE_CSS_LENGTHS_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    return false;\n  };\n\n  Color.normalize = function (codeCSS) {\n    var color = new Color(codeCSS);\n    return color.stringify();\n  };\n\n  Color.luminance = function (codeCSS) {\n    var color = new Color(codeCSS);\n    return color.luminance();\n  };\n  /**\n   * Returns 1 for bright colors and 0 for dark colors.\n   */\n\n\n  Color.luminanceStep = function (codeCSS) {\n    var color = new Color(codeCSS);\n    return color.luminanceStep();\n  };\n\n  Color.fromArrayRGB = function (rgb) {\n    var _a = __read(rgb, 3),\n        R = _a[0],\n        G = _a[1],\n        B = _a[2];\n\n    return Color.newRGB(R, G, B);\n  };\n\n  Color.fromArrayRGBA = function (rgba) {\n    var _a = __read(rgba, 4),\n        R = _a[0],\n        G = _a[1],\n        B = _a[2],\n        A = _a[3];\n\n    return Color.newRGBA(R, G, B, A);\n  };\n  /**\n   * Mix two colors. alpha should be between 0 and 1,\n   * but there is no check on this.\n   * If alpha is 0, the resulting color is `color1`,\n   * if alpha is 1, the resulting color is `color2`.\n   */\n\n\n  Color.mix = function (color1, color2, alpha) {\n    if (alpha === void 0) {\n      alpha = 0.5;\n    }\n\n    var beta = 1 - alpha;\n    return Color.newRGBA(alpha * color2.R + beta * color1.R, alpha * color2.G + beta * color1.G, alpha * color2.B + beta * color1.B, alpha * color2.A + beta * color1.A);\n  };\n  /**\n   * If `colors` has only two elements, this method is the same as `mix()`.\n   * Otherwise, it will perform a linear blending through the colors.\n   * If alpha is 0, the resulting color is `colors[0]`,\n   * If alpha is 1, the resulting color is `colors[colors.length - 1]`,\n   */\n\n\n  Color.ramp = function (colors, alpha) {\n    if (alpha === void 0) {\n      alpha = 0.5;\n    }\n\n    if (colors.length === 0) {\n      return Color.newBlack();\n    }\n\n    if (colors.length === 1) {\n      return colors[0];\n    }\n\n    var spacesCount = colors.length - 1;\n    var firstColorIndex = Math.floor(alpha * spacesCount);\n    var color1 = colors[firstColorIndex];\n\n    if (firstColorIndex === spacesCount) {\n      return color1;\n    }\n\n    var color2 = colors[firstColorIndex + 1];\n    var translatedAlpha = firstColorIndex + alpha / spacesCount;\n    return Color.mix(color1, color2, translatedAlpha);\n  };\n\n  Color.newBlack = function () {\n    return Color.newRGB(0, 0, 0);\n  };\n\n  Color.newWhite = function () {\n    return Color.newRGB(1, 1, 1);\n  };\n  /**\n   * Create a new Color instance base on R,G,B channels.\n   *\n   * @param red - Value between 0 and 1.\n   * @param green - Value between 0 and 1.\n   * @param blue - Value between 0 and 1.\n   * @returns New instance of Color.\n   */\n\n\n  Color.newRGB = function (red, green, blue) {\n    var color = new Color();\n    color.R = red;\n    color.G = green;\n    color.B = blue;\n    color.A = 1;\n    return color;\n  };\n  /**\n   * Create a new Color instance base on R,G,B,A channels.\n   *\n   * @param red - Value between 0 and 1.\n   * @param green - Value between 0 and 1.\n   * @param blue - Value between 0 and 1.\n   * @param alpha - Value between 0 and 1.\n   * @returns New instance of Color.\n   */\n\n\n  Color.newRGBA = function (red, green, blue, alpha) {\n    var color = new Color();\n    color.R = red;\n    color.G = green;\n    color.B = blue;\n    color.A = alpha;\n    return color;\n  };\n\n  Color.prototype.toArrayRGB = function () {\n    return [this.R, this.G, this.B];\n  };\n\n  Color.prototype.toArrayRGBA = function () {\n    return [this.R, this.G, this.B, this.A];\n  };\n  /**\n   * Parse a color writtent in CSS syntax.\n   *\n   * @param code - CSS color.\n   * @returns `true` if the color has valid syntax.\n   */\n\n\n  Color.prototype.parse = function (code) {\n    if (code === void 0) {\n      code = '#000000';\n    }\n\n    var input = code.trim().toUpperCase();\n\n    if (this.parseHexa.call(this, input)) {\n      return true;\n    }\n\n    if (this.parseRGB.call(this, input)) {\n      return true;\n    }\n\n    if (this.parseRGBA.call(this, input)) {\n      return true;\n    }\n\n    if (this.parseHSL.call(this, input)) {\n      return true;\n    } // @TODO parseHSLA.\n\n\n    return false;\n  };\n  /**\n   * @see https://en.wikipedia.org/wiki/Grayscale\n   * @this Color\n   * @returns {undefined}\n   */\n\n\n  Color.prototype.luminance = function () {\n    var LUM_RED = 0.2126;\n    var LUM_GREEN = 0.7152;\n    var LUM_BLUE = 0.0722;\n    return LUM_RED * this.R + LUM_GREEN * this.G + LUM_BLUE * this.B;\n  };\n  /**\n   * @returns {integer} 0 if the color is dark and 1 if it is light.\n   */\n\n\n  Color.prototype.luminanceStep = function () {\n    return this.luminance() < LUMINANCE_THRESHOLD ? 0 : 1;\n  };\n  /**\n   * @this Color\n   * @returns String value of the color. `#fd45a7`.\n   */\n\n\n  Color.prototype.stringify = function () {\n    var FF = 0xFF;\n    var color = hexa2(this.R * FF) + hexa2(this.G * FF) + hexa2(this.B * FF);\n\n    if (this.A < 1) {\n      color += hexa2(this.A * FF);\n    }\n\n    return \"#\" + color;\n  };\n\n  Color.prototype.copy = function () {\n    var newColor = new Color();\n    newColor.R = this.R;\n    newColor.G = this.G;\n    newColor.B = this.B;\n    newColor.A = this.A;\n    newColor.H = this.H;\n    newColor.S = this.S;\n    newColor.L = this.L;\n    return newColor;\n  };\n  /**\n   * @see https://en.wikipedia.org/wiki/HSL_and_HSV#Converting_to_RGB\n   */\n\n\n  Color.prototype.hsl2rgb = function () {\n    var H = 6 * this.H;\n    var S = this.S;\n    var L = this.L;\n    var chroma = (1 - Math.abs(2 * L - 1)) * S;\n    var x = chroma * (1 - Math.abs(H % 2 - 1));\n    var R = 0;\n    var G = 0;\n    var B = 0;\n\n    if (H < 3) {\n      if (H < 1) {\n        R = chroma;\n        G = x;\n        B = 0;\n      } else if (H < 2) {\n        R = x;\n        G = chroma;\n        B = 0;\n      } else {\n        // H == 2.\n        R = 0;\n        G = chroma;\n        B = x;\n      }\n    } else if (H < 4) {\n      R = 0;\n      G = x;\n      B = chroma;\n    } else if (H < 5) {\n      R = x;\n      G = 0;\n      B = chroma;\n    } else {\n      R = chroma;\n      G = 0;\n      B = x;\n    }\n\n    var shift = L - chroma * 0.5;\n    this.R = R + shift;\n    this.G = G + shift;\n    this.B = B + shift;\n  };\n\n  Color.prototype.rgb2hsl = function () {\n    var R = this.R;\n    var G = this.G;\n    var B = this.B;\n    var min = Math.min(R, G, B);\n    var max = Math.max(R, G, B);\n    var delta = max - min;\n    this.L = 0.5 * (max + min);\n\n    if (delta < 0.000001) {\n      this.H = 0;\n      this.S = 0;\n    } else {\n      this.S = delta / (1 - Math.abs(2 * this.L - 1));\n\n      if (max === R) {\n        if (G >= B) {\n          this.H = INV6 * ((G - B) / delta);\n        } else {\n          this.H = 1 - INV6 * ((B - G) / delta);\n        }\n      } else if (max === G) {\n        this.H = INV6 * (2 + (B - R) / delta);\n      } else {\n        this.H = INV6 * (4 + (R - G) / delta);\n      }\n    }\n  };\n\n  Color.prototype.parseHexa = function (text) {\n    if (text.charAt(0) !== '#') {\n      return false;\n    }\n\n    var R = 0;\n    var G = 0;\n    var B = 0;\n    var A = 1;\n\n    switch (text.length) {\n      case 4:\n        R = parseInt(text.charAt(1), 16) * INV15;\n        G = parseInt(text.charAt(2), 16) * INV15;\n        B = parseInt(text.charAt(3), 16) * INV15;\n        break;\n\n      case 5:\n        R = parseInt(text.charAt(1), 16) * INV15;\n        G = parseInt(text.charAt(2), 16) * INV15;\n        B = parseInt(text.charAt(3), 16) * INV15;\n        A = parseInt(text.charAt(4), 16) * INV15;\n        break;\n\n      case 7:\n        R = parseInt(text.substr(1, 2), 16) * INV255;\n        G = parseInt(text.substr(3, 2), 16) * INV255;\n        B = parseInt(text.substr(5, 2), 16) * INV255;\n        break;\n\n      case 9:\n        R = parseInt(text.substr(1, 2), 16) * INV255;\n        G = parseInt(text.substr(3, 2), 16) * INV255;\n        B = parseInt(text.substr(5, 2), 16) * INV255;\n        A = parseInt(text.substr(7, 2), 16) * INV255;\n        break;\n\n      default:\n    }\n\n    if (isNaN(R) || isNaN(G) || isNaN(B) || isNaN(A)) {\n      this.R = this.G = this.B = this.A = 0;\n    } else {\n      this.R = R;\n      this.G = G;\n      this.B = B;\n      this.A = A;\n    }\n\n    return true;\n  };\n  /**\n   * @param text - `rgb(200, 140, 50)`\n   * @returns `true` if `text` is a valid `rgb()` syntax.\n   */\n\n\n  Color.prototype.parseRGB = function (text) {\n    var m = RX_RGB.exec(text);\n\n    if (!m) {\n      return false;\n    }\n\n    this.R = clamp01(parseInt(m[1], 10) * INV255);\n    this.G = clamp01(parseInt(m[2], 10) * INV255);\n    this.B = clamp01(parseInt(m[3], 10) * INV255);\n    this.A = 1;\n    return true;\n  };\n  /**\n   * @param text - `rgba(200, 140, 50, 0.5)`\n   * @returns `true` if `text` is a valid `rgba()` syntax.\n   */\n\n\n  Color.prototype.parseRGBA = function (text) {\n    var m = RX_RGBA.exec(text);\n\n    if (!m) {\n      return false;\n    }\n\n    this.R = clamp01(parseInt(m[1], 10) * INV255);\n    this.G = clamp01(parseInt(m[2], 10) * INV255);\n    this.B = clamp01(parseInt(m[3], 10) * INV255);\n    this.A = clamp01(parseFloat(m[4]));\n    return true;\n  };\n  /**\n   * @param text - `hsl(200, 140, 50)`\n   * @returns `true` if `text` is a valid `hsl()` syntax.\n   */\n\n\n  Color.prototype.parseHSL = function (text) {\n    var m = RX_HSL.exec(text);\n\n    if (!m) {\n      return false;\n    }\n\n    this.H = clamp01(parseInt(m[1], 10) * INV359);\n    this.S = clamp01(parseInt(m[2], 10) * INV99);\n    this.L = clamp01(parseInt(m[3], 10) * INV99);\n    this.A = 1;\n    this.hsl2rgb();\n    return true;\n  };\n\n  return Color;\n}();\n\nexport default Color;\nvar INV6 = 1 / 6;\nvar INV15 = 1 / 15;\nvar INV99 = 1 / 99;\nvar INV255 = 1 / 255;\nvar INV359 = 1 / 359;\nvar RX_RGB = /^RGB[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;\nvar RX_RGBA = /^RGBA[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)[^0-9.]+([0-9.]+)/;\nvar RX_HSL = /^HSL[\\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;\n\nfunction clamp01(value) {\n  if (value < 0) {\n    return 0;\n  }\n\n  if (value > 1) {\n    return 1;\n  }\n\n  return value;\n}\n\nfunction hexa2(value) {\n  var out = Math.floor(value).toString(16);\n\n  if (out.length < 2) {\n    out = \"0\" + out;\n  }\n\n  return out;\n}","import { __extends } from \"tslib\";\n/**\n * Clear the screen by filling it with a plain color.\n * This color is defined by attributes red, gree, blue and alpha, which must be between 0 and 1.\n */\n\nimport Color from '../webgl/color';\nimport Painter from './painter';\n\nvar ClearPainter =\n/** @class */\nfunction (_super) {\n  __extends(ClearPainter, _super);\n\n  function ClearPainter(params) {\n    var _this = _super.call(this) || this;\n\n    _this.params = params;\n    _this._red = 0.8;\n    _this._green = 0.4;\n    _this._blue = 0.2;\n    _this._alpha = 1;\n    return _this;\n  }\n\n  Object.defineProperty(ClearPainter.prototype, \"red\", {\n    get: function get() {\n      return this._red;\n    },\n    set: function set(v) {\n      this._red = v;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ClearPainter.prototype, \"green\", {\n    get: function get() {\n      return this._green;\n    },\n    set: function set(v) {\n      this._green = v;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ClearPainter.prototype, \"blue\", {\n    get: function get() {\n      return this._blue;\n    },\n    set: function set(v) {\n      this._blue = v;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ClearPainter.prototype, \"alpha\", {\n    get: function get() {\n      return this._alpha;\n    },\n    set: function set(v) {\n      this._alpha = v;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ClearPainter.prototype, \"color\", {\n    get: function get() {\n      var color = new Color();\n      color.R = this._red;\n      color.G = this._green;\n      color.B = this._blue;\n      color.A = this._alpha;\n      return color.stringify();\n    },\n    set: function set(cssColor) {\n      var color = new Color(cssColor);\n      this._red = color.R;\n      this._green = color.G;\n      this._blue = color.B;\n      this._alpha = color.A;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ClearPainter.prototype.render = function () {\n    var scene = this.scene;\n\n    if (!scene) {\n      return;\n    }\n\n    var gl = scene.gl;\n    gl.clearColor(this._red, this._green, this._blue, this._alpha);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n  };\n\n  ClearPainter.prototype.initialize = function () {\n    if (this.params) {\n      this.color = this.params.color || '#d72';\n    }\n  };\n\n  ClearPainter.prototype.destroy = function () {// Nothing to destroy for this painter.\n  };\n\n  return ClearPainter;\n}(Painter);\n\nexport default ClearPainter;","var VirtualSprite =\n/** @class */\nfunction () {\n  function VirtualSprite(id, data, update, destroy) {\n    this.$index = -1;\n    this.extra = {};\n    this._id = id;\n    this._data = data;\n    this._update = update;\n    this._destroy = destroy;\n  }\n\n  Object.defineProperty(VirtualSprite.prototype, \"id\", {\n    get: function get() {\n      return this._id;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  VirtualSprite.prototype.destroy = function () {\n    this._destroy(this);\n  };\n\n  return VirtualSprite;\n}();\n\nexport default VirtualSprite;","/**\n * Quads are actually any kind of quadrilaters.\n * Each corner has 5 attributes:\n * - x, y, z: space coords.\n * - u, v: atlas coords.\n *\n * They are suffixed with:\n * - TL: Top Left corner.\n * - TR: Top Right corner.\n * - BR: Bottom Right corner.\n * - BL: Bottom Left corner.\n */\nimport { __assign, __extends } from \"tslib\";\nimport VirtualSprite from \"./virtual-sprite\";\n\nvar Quad =\n/** @class */\nfunction (_super) {\n  __extends(Quad, _super);\n\n  function Quad(id, data, update, destroy, params) {\n    var _this = _super.call(this, id, data, update, destroy) || this;\n\n    _this._params = params;\n    return _this;\n  }\n\n  Quad.prototype.update = function (newParams) {\n    if (newParams) {\n      this._params = __assign(__assign({}, this._params), newParams);\n    }\n\n    var _a = this._params,\n        xTL = _a.xTL,\n        yTL = _a.yTL,\n        zTL = _a.zTL,\n        uTL = _a.uTL,\n        vTL = _a.vTL,\n        xTR = _a.xTR,\n        yTR = _a.yTR,\n        zTR = _a.zTR,\n        uTR = _a.uTR,\n        vTR = _a.vTR,\n        xBR = _a.xBR,\n        yBR = _a.yBR,\n        zBR = _a.zBR,\n        uBR = _a.uBR,\n        vBR = _a.vBR,\n        xBL = _a.xBL,\n        yBL = _a.yBL,\n        zBL = _a.zBL,\n        uBL = _a.uBL,\n        vBL = _a.vBL;\n    var data = this._data; // tslint:disable:no-magic-numbers\n\n    data[0] = xTL;\n    data[1] = yTL;\n    data[2] = zTL;\n    data[3] = uTL;\n    data[4] = vTL;\n    data[5] = xTR;\n    data[6] = yTR;\n    data[7] = zTR;\n    data[8] = uTR;\n    data[9] = vTR;\n    data[10] = xBR;\n    data[11] = yBR;\n    data[12] = zBR;\n    data[13] = uBR;\n    data[14] = vBR;\n    data[15] = xBL;\n    data[16] = yBL;\n    data[17] = zBL;\n    data[18] = uBL;\n    data[19] = vBL; // tslint:enable:no-magic-numbers\n\n    this._update(this, data);\n  };\n\n  return Quad;\n}(VirtualSprite);\n\nexport default Quad;","/**\n * Sprites management is complex because we must be able to add sprites\n * even for Painters that are not yet used in a Scene.\n */\nimport { __assign, __extends } from \"tslib\";\nimport Calc from '../../calc';\nimport VirtualSprite from \"./virtual-sprite\";\n\nvar Sprite =\n/** @class */\nfunction (_super) {\n  __extends(Sprite, _super);\n\n  function Sprite(id, data, update, destroy, params) {\n    var _this = _super.call(this, id, data, update, destroy) || this;\n\n    _this._params = params;\n    return _this;\n  }\n\n  Object.defineProperty(Sprite.prototype, \"x\", {\n    get: function get() {\n      return this._params.x;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"y\", {\n    get: function get() {\n      return this._params.y;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"z\", {\n    get: function get() {\n      return this._params.z;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"width\", {\n    get: function get() {\n      return this._params.width;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"height\", {\n    get: function get() {\n      return this._params.height;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"originX\", {\n    get: function get() {\n      return this._params.originX;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"originY\", {\n    get: function get() {\n      return this._params.originY;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"u0\", {\n    get: function get() {\n      return this._params.u0;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"v0\", {\n    get: function get() {\n      return this._params.v0;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"u1\", {\n    get: function get() {\n      return this._params.u1;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"v1\", {\n    get: function get() {\n      return this._params.v1;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Sprite.prototype.update = function (newParams) {\n    if (newParams) {\n      this._params = __assign(__assign({}, this._params), newParams);\n    }\n\n    var _a = this._params,\n        x = _a.x,\n        y = _a.y,\n        z = _a.z,\n        originX = _a.originX,\n        originY = _a.originY,\n        width = _a.width,\n        height = _a.height,\n        u0 = _a.u0,\n        v0 = _a.v0,\n        u1 = _a.u1,\n        v1 = _a.v1,\n        scale = _a.scale,\n        angle = _a.angle;\n    var xxA = -originX;\n    var yyA = -originY;\n    var xxB = xxA + width;\n    var yyB = yyA;\n    var xxC = xxA + width;\n    var yyC = yyA + height;\n    var xxD = xxA;\n    var yyD = yyA + height;\n    var xA = xxA * scale;\n    var yA = yyA * scale;\n    var xB = xxB * scale;\n    var yB = yyB * scale;\n    var xC = xxC * scale;\n    var yC = yyC * scale;\n    var xD = xxD * scale;\n    var yD = yyD * scale; // tslint:disable-next-line:no-bitwise\n\n    if ((angle | 0) !== 0) {\n      var C = Calc.cos(angle);\n      var S = Calc.sin(angle);\n      xA = (xxA * C + yyA * S) * scale;\n      yA = (yyA * C - xxA * S) * scale;\n      xB = (xxB * C + yyB * S) * scale;\n      yB = (yyB * C - xxB * S) * scale;\n      xC = (xxC * C + yyC * S) * scale;\n      yC = (yyC * C - xxC * S) * scale;\n      xD = (xxD * C + yyD * S) * scale;\n      yD = (yyD * C - xxD * S) * scale;\n    }\n\n    var data = this._data; // tslint:disable:no-magic-numbers\n\n    data[0] = xA + x;\n    data[1] = yA + y;\n    data[2] = z;\n    data[3] = u0;\n    data[4] = v1;\n    data[5] = xB + x;\n    data[6] = yB + y;\n    data[7] = z;\n    data[8] = u1;\n    data[9] = v1;\n    data[10] = xC + x;\n    data[11] = yC + y;\n    data[12] = z;\n    data[13] = u1;\n    data[14] = v0;\n    data[15] = xD + x;\n    data[16] = yD + y;\n    data[17] = z;\n    data[18] = u0;\n    data[19] = v0; // tslint:enable:no-magic-numbers\n\n    this._update(this, data);\n  };\n\n  return Sprite;\n}(VirtualSprite);\n\nexport default Sprite;","import { __assign, __extends, __read, __values } from \"tslib\";\nimport Painter from '../painter';\nimport Quad from './quad';\nimport Sprite from './sprite';\nimport frag from './sprites.frag';\nimport vert from './sprites.vert'; // Allocations will be done by pieces of BLOCK Sprites.\n\nvar BLOCK = 64;\nvar NB_ATTRIBS = 5; // attXYZ and attUV.\n\nvar NB_ELEMS = 6; // Two triangles of 3 points to get a square.\n\nvar NB_CORNERS = 4;\nvar CHUNK = NB_ATTRIBS * NB_CORNERS;\nvar DEFAULT_WIDTH = 64;\nvar DEFAULT_HEIGHT = 64;\nvar HALF = 0.5;\nvar globalID = 1;\n\nvar SpritesPainter =\n/** @class */\nfunction (_super) {\n  __extends(SpritesPainter, _super);\n\n  function SpritesPainter(params) {\n    var _this = _super.call(this) || this;\n\n    _this._capacity = BLOCK;\n    _this._dataVert = new Float32Array(BLOCK * CHUNK); // We need to keep track of all the inserted sprites because when we want to destroy\n    // one, we wnat to exchange its position with the one at the end of the list for\n    // optimisation purpose.\n\n    _this._sprites = [];\n\n    _this._update = function (sprite, data) {\n      if (!_this.scene) {\n        // If this painter has not yet been initialized, then update has to be defered.\n        _this._deferedSpritesUpdate.set(sprite.id, [sprite, data]);\n\n        return;\n      }\n\n      if (sprite.$index < 0) {\n        _this._allocate(sprite);\n      }\n\n      _this._dataVert.set(data, CHUNK * sprite.$index);\n    };\n    /**\n     * Only called by an instance os Sprite.\n     */\n\n\n    _this._destroy = function (sprite) {\n      var lastSprite = _this._sprites.pop();\n\n      if (!lastSprite) {\n        console.error(\"You tried to destroy a Sprite that is not owned by this painter!\", sprite);\n        return;\n      }\n\n      var indexOfLastSprite = lastSprite.$index;\n\n      if (indexOfLastSprite !== sprite.$index) {\n        // Swap positions of destroyed sprite and last sprite in the list.\n        lastSprite.$index = sprite.$index;\n        _this._sprites[lastSprite.$index] = lastSprite;\n        lastSprite.update();\n      }\n\n      sprite.$index = -1;\n    };\n\n    _this._atlas = params.atlas;\n    _this._camera = params.camera;\n    _this._deferedSpritesUpdate = new Map();\n    return _this;\n  }\n\n  Object.defineProperty(SpritesPainter.prototype, \"atlas\", {\n    get: function get() {\n      return this._atlas;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SpritesPainter.prototype, \"count\", {\n    get: function get() {\n      return this._sprites.length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * Register a new sprite that will be immediatly visible.\n   */\n\n  SpritesPainter.prototype.createSprite = function (params) {\n    var atlas = this.atlas;\n    var width = atlas.width || DEFAULT_WIDTH;\n    var height = atlas.height || DEFAULT_HEIGHT;\n    var data = new Float32Array(CHUNK);\n    var sprite = new Sprite(\"\" + globalID++, data, this._update, this._destroy, __assign({\n      x: 0,\n      y: 0,\n      z: 0,\n      width: width,\n      height: height,\n      originX: width * HALF,\n      originY: width * HALF,\n      u0: 0,\n      v0: 0,\n      u1: 1,\n      v1: 1,\n      scale: 1,\n      angle: 0\n    }, params));\n    sprite.update();\n    return sprite;\n  };\n  /**\n   * Register a new sprite that will be immediatly visible.\n   */\n\n\n  SpritesPainter.prototype.createQuad = function (params) {\n    var data = new Float32Array(CHUNK);\n    var sprite = new Quad(\"\" + globalID++, data, this._update, this._destroy, __assign({\n      xTL: 0,\n      yTL: 0,\n      zTL: 0,\n      uTL: 0,\n      vTL: 0,\n      xTR: 1024,\n      yTR: 0,\n      zTR: 0,\n      uTR: 1,\n      vTR: 0,\n      xBR: 1024,\n      yBR: 1024,\n      zBR: 0,\n      uBR: 1,\n      vBR: 1,\n      xBL: 0,\n      yBL: 1024,\n      zBL: 0,\n      uBL: 0,\n      vBL: 1\n    }, params));\n    sprite.update();\n    return sprite;\n  };\n  /**\n   * Only called by an instance os Sprite.\n   */\n\n\n  SpritesPainter.prototype._allocate = function (sprite) {\n    if (this._capacity <= this.count) {\n      this._allocateNewBlock();\n    }\n\n    sprite.$index = this.count;\n\n    this._sprites.push(sprite);\n  };\n  /**\n   * When the number of sprites exceeds the current capacity, we must allocate a new BLOCK.\n   * This function cannot be called before painter initialization.\n   */\n\n\n  SpritesPainter.prototype._allocateNewBlock = function () {\n    this._capacity += BLOCK;\n\n    var _a = this,\n        scene = _a.scene,\n        _buffElem = _a._buffElem;\n\n    if (!scene) {\n      throw Error('No scene!');\n    }\n\n    if (!_buffElem) {\n      throw Error('No buffElem!');\n    }\n\n    var gl = scene.gl;\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _buffElem);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, createElements(this._capacity), gl.DYNAMIC_DRAW);\n    var dataVert = new Float32Array(this._capacity * CHUNK);\n    dataVert.set(this._dataVert);\n    this._dataVert = dataVert;\n  };\n\n  SpritesPainter.prototype.render = function (time, delta) {\n    var _a = this,\n        scene = _a.scene,\n        _prg = _a._prg,\n        atlas = _a.atlas,\n        _buffVert = _a._buffVert,\n        _buffElem = _a._buffElem,\n        _camera = _a._camera;\n\n    if (!scene || !_prg || !atlas || !_buffVert || !_buffElem) {\n      return;\n    }\n\n    var gl = scene.gl; // Update sprites' attributes.\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, _buffVert);\n    gl.bufferData(gl.ARRAY_BUFFER, this._dataVert, gl.DYNAMIC_DRAW);\n    gl.enable(gl.DEPTH_TEST);\n\n    _prg.use();\n\n    _camera.setUniformValues(_prg, scene.width, scene.height, time, delta);\n\n    atlas.activate();\n    var uniforms = _prg;\n    uniforms.$uniTexture = 0;\n\n    _prg.bindAttribs(_buffVert, 'attXYZ', 'attUV');\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, _buffVert);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, _buffElem);\n    gl.drawElements(gl.TRIANGLES, NB_ELEMS * this.count, gl.UNSIGNED_SHORT, 0);\n  };\n\n  SpritesPainter.prototype.initialize = function (scene) {\n    this._prg = this.createProgram({\n      vert: vert,\n      frag: frag\n    }, this._camera.getShaderIncludes());\n    var gl = scene.gl;\n    var buffVert = gl.createBuffer();\n\n    if (!buffVert) {\n      throw this.fatal('Not enough memory to create an array buffer!');\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffVert);\n    gl.bufferData(gl.ARRAY_BUFFER, this._dataVert, gl.DYNAMIC_DRAW);\n    this._buffVert = buffVert;\n    var buffElem = gl.createBuffer();\n\n    if (!buffElem) {\n      throw this.fatal('Not enough memory to create an array buffer!');\n    }\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffElem);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, createElements(BLOCK), gl.DYNAMIC_DRAW);\n    this._buffElem = buffElem;\n    this.manageDeferedSpritesUpdates();\n  };\n\n  SpritesPainter.prototype.destroy = function () {\n    var _a = this,\n        scene = _a.scene,\n        _buffVert = _a._buffVert,\n        _buffElem = _a._buffElem;\n\n    if (!scene || !_buffVert || !_buffElem) {\n      return;\n    }\n\n    var gl = scene.gl;\n    gl.deleteBuffer(_buffVert);\n    gl.deleteBuffer(_buffElem);\n  };\n\n  SpritesPainter.prototype.manageDeferedSpritesUpdates = function () {\n    var e_1, _a;\n\n    if (this._deferedSpritesUpdate.size === 0) {\n      // Nothing to do.\n      return;\n    }\n\n    try {\n      for (var _b = __values(this._deferedSpritesUpdate.values()), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var item = _c.value;\n\n        var _d = __read(item, 2),\n            sprite = _d[0],\n            data = _d[1];\n\n        this._update(sprite, data);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  return SpritesPainter;\n}(Painter);\n\nexport default SpritesPainter;\nvar CORNER_B = 1;\nvar CORNER_C = 2;\nvar CORNER_D = 3;\n/**\n * A--B\n * |  |\n * D--C\n */\n\nfunction createElements(capacity) {\n  var dataElem = new Uint16Array(NB_ELEMS * capacity);\n  var i = 0;\n  var a = 0;\n\n  for (var k = 0; k < capacity; k++) {\n    var b = a + CORNER_B;\n    var c = a + CORNER_C;\n    var d = a + CORNER_D; // tslint:disable:no-magic-numbers\n\n    dataElem[i + 0] = a;\n    dataElem[i + 1] = d;\n    dataElem[i + 2] = b;\n    dataElem[i + 3] = b;\n    dataElem[i + 4] = d;\n    dataElem[i + 5] = c; // tslint:enable:no-magic-numbers\n\n    a += NB_CORNERS;\n    i += NB_ELEMS;\n  }\n\n  return dataElem;\n}","export default \"uniform float uniWidth;\\nuniform float uniHeight;\\n\\nattribute vec3 attXYZ;\\nattribute vec2 attUV;\\n\\nvarying vec2 varUV;\\n\\n#include cameraUniforms\\n#include cameraFunction\\n\\nvoid main() {\\n  varUV = attUV;\\n  gl_Position = worldPointToScreen(attXYZ);\\n}\\n\"","export default \"precision mediump float;\\nuniform sampler2D uniTexture;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  vec4 color = texture2D( uniTexture, varUV );\\n  if (color.a < 1.0) discard;\\n  gl_FragColor = color;\\n}\\n\"","import { __assign, __extends } from \"tslib\";\nimport Painter from '../painter';\nimport Vert from './voronoi.vert';\nimport Frag from './voronoi.frag';\nvar NB_VERTICES_IN_SQUARE = 4;\n\nvar VoronoiPainter =\n/** @class */\nfunction (_super) {\n  __extends(VoronoiPainter, _super);\n  /**\n   * params: { atlas, align }\n   * - align: if undefined, the voronoi will be centered.\n   *          \"R\" means that the Right edge of the voronoi is always visible.\n   *          \"L\" means the same for Left.\n   *          \"T\" for Top.\n   *          \"B\" for \"Bottom\".\n   */\n\n\n  function VoronoiPainter(params) {\n    var _this = _super.call(this) || this;\n\n    _this.params = __assign({\n      seeds: randomArray(20),\n      colors: randomArray(20),\n      border: 0,\n      light: 0,\n      scaleX: 1,\n      scaleY: 1\n    }, params);\n\n    if (_this.params.seeds.length % 3 !== 0) {\n      throw Error(\"The length of \\\"seeds\\\" must be an integral multiple of 3!\");\n    }\n\n    if (_this.params.seeds.length !== _this.params.colors.length) {\n      throw Error(\"\\\"seeds\\\" and \\\"colors\\\" must have the same length!\");\n    }\n\n    _this.seeds = new Float32Array(_this.params.seeds);\n    _this.colors = new Float32Array(_this.params.colors);\n    return _this;\n  }\n\n  VoronoiPainter.prototype.render = function () {\n    var _a = this,\n        scene = _a.scene,\n        prg = _a.prg,\n        buff = _a.buff;\n\n    if (!scene || !prg || !buff) {\n      return;\n    }\n\n    var _b = this.params,\n        border = _b.border,\n        scaleX = _b.scaleX,\n        scaleY = _b.scaleY;\n    var thickness = border;\n    var gl = scene.gl;\n    gl.enable(gl.DEPTH_TEST);\n    prg.use();\n    prg.setUniform(\"uniSeeds\", this.seeds);\n    prg.setUniform(\"uniColors\", this.colors);\n    prg.setUniform(\"uniLight\", this.params.light);\n    prg.setUniform(\"uniThickness\", thickness);\n    prg.setUniform(\"uniScaleX\", scaleX);\n    prg.setUniform(\"uniScaleY\", scaleY);\n    prg.bindAttribs(buff, 'attXY');\n    gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, NB_VERTICES_IN_SQUARE);\n  };\n  /*\n      private getSeeds(time: number) {\n          const { lastTime } = this;\n          let alpha = (time - lastTime) / DURATION\n          if (alpha > 3) {\n              this.lastTime = time\n              this.seeds0 = this.seeds1\n              this.seeds1 = randomArray()\n              alpha = 0\n          }\n          alpha = Math.min(alpha, 1)\n  \n          const mix = []\n          const { seeds0, seeds1 } = this\n          const beta = 1 - alpha\n          for (let i = 0; i < seeds1.length; i++) {\n              mix.push(beta * seeds0[i] + alpha * seeds1[i])\n          }\n          return new Float32Array(mix)\n      }\n  */\n\n\n  VoronoiPainter.prototype.destroy = function (scene) {\n    var gl = scene.gl;\n    var buff = this.buff;\n\n    if (!buff) {\n      return;\n    }\n\n    gl.deleteBuffer(buff);\n  };\n\n  VoronoiPainter.prototype.initialize = function (scene) {\n    this.prg = this.createProgram({\n      frag: Frag,\n      vert: Vert\n    }, {\n      count: \"const int COUNT = \" + this.params.seeds.length + \";\"\n    });\n    var gl = scene.gl;\n    var buff = gl.createBuffer();\n\n    if (!buff) {\n      throw this.fatal('Not enough memory to create an array buffer!');\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n    this.buff = buff;\n  };\n\n  return VoronoiPainter;\n}(Painter);\n\nexport default VoronoiPainter;\n\nfunction randomArray(count) {\n  var arr = [];\n\n  for (var i = 0; i < 3 * count; i++) {\n    arr.push(Math.random());\n  }\n\n  return arr;\n}","import BackgroundPainter from './background';\nimport ClearPainter from './clear';\nimport Painter from './painter';\nimport SpritesPainter from './sprites';\nimport VoronoiPainter from './voronoi';\nexport default {\n  Background: BackgroundPainter,\n  Clear: ClearPainter,\n  Painter: Painter,\n  Sprites: SpritesPainter,\n  Voronoi: VoronoiPainter\n};","export default \"precision mediump float;\\n\\n#include \\\"count\\\"\\n\\nconst vec3 WHITE = vec3(1,1,1);\\nconst vec3 BLACK = vec3(0,0,0);\\n\\nuniform float uniSeeds[COUNT];\\nuniform float uniColors[COUNT];\\nuniform float uniLight;\\nuniform float uniThickness;\\n\\n/**\\n * The coords of a and b must be in the range [0;1].\\n */\\nfloat distSquared(vec2 a, vec2 b) {\\n  float x = abs(a.x - b.x);\\n  if (x > .5) x = 1.0 - x;\\n  float y = abs(a.y - b.y);\\n  if (y > .5) y = 1.0 - y;\\n\\n  return x*x + y*y;\\n}\\n\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  vec2 M = vec2(fract(varUV.x), fract(varUV.y));\\n\\n  float distA = distSquared(M, vec2(uniSeeds[0], uniSeeds[1])) * uniSeeds[2];\\n  vec3 seedA = vec3(uniSeeds[0], uniSeeds[1], uniSeeds[2]);\\n  vec3 colorA = vec3(uniColors[0], uniColors[1], uniColors[2]);\\n  float distB = distSquared(M, vec2(uniSeeds[3], uniSeeds[4])) * uniSeeds[5];\\n  vec3 seedB = vec3(uniSeeds[3], uniSeeds[4], uniSeeds[5]);\\n  vec3 colorB = vec3(uniColors[3], uniColors[4], uniColors[5]);\\n\\n  if (distB < distA) {\\n    float swaperDist = distA;\\n    distA = distB;\\n    distB = swaperDist;\\n    vec3 swaperSeed = seedA;\\n    seedA = seedB;\\n    seedB = swaperSeed;\\n    vec3 swaperColor = colorA;\\n    colorA = colorB;\\n    colorB = swaperColor;\\n  }\\n\\n  float dist;\\n  vec3 seed;\\n  vec3 color;\\n\\n  for (int i = 6; i < COUNT; i+=3) {\\n    seed = vec3(uniSeeds[i], uniSeeds[i+1], uniSeeds[i+2]);\\n    color = vec3(uniColors[i], uniColors[i+1], uniColors[i+2]);\\n    dist = distSquared(M, seed.xy) * seed.z;\\n    if (dist < distA) {\\n      distB = distA;\\n      seedB = seedA;\\n      colorB = colorA;\\n      distA = dist;\\n      seedA = seed;\\n      colorA = color;\\n    }\\n    else if (dist < distB) {\\n      distB = dist;\\n      seedB = seed;\\n      colorB = color;\\n    }\\n  }\\n\\n/*\\n  vec2 AM = M.xy - seedA.xy;\\n  vec2 AB = seedB.xy - seedA.xy;\\n  vec2 AB1 = normalize(AB);\\n  float semiLengthAB = length(AB) * 0.5;\\n  float distanceFromBorder = semiLengthAB - dot(AM, AB1);\\n*/\\n\\n  float dA = distA;\\n  float dB = distB;\\n  float distanceFromBorder = dB - dA;\\n  float alpha;\\n  vec3 color0;\\n  vec3 color1;\\n\\n  if (distanceFromBorder < uniThickness) {\\n      // Border.\\n      color0 = BLACK;\\n      color1 = colorA;\\n      alpha = smoothstep(0.0, uniThickness, distanceFromBorder);\\n  } else {\\n      // Cell.\\n      color0 = colorA;\\n      color1 = mix(colorA, WHITE, uniLight);\\n      alpha = (distanceFromBorder - uniThickness) / (dB - uniThickness);\\n  }\\n\\n  gl_FragColor = vec4(mix(color0, color1, alpha), 1);\\n}\\n\"","export default \"uniform float uniScaleX;\\nuniform float uniScaleY;\\n\\nattribute vec2 attXY;\\nvarying vec2 varUV;\\n\\nvoid main() {\\n  varUV = vec2(attXY.x * uniScaleX, attXY.y * uniScaleY);\\n  float x = (attXY.x * 2.0) - 1.0;\\n  float y = 1.0 - (attXY.y * 2.0);\\n  gl_Position = vec4(x, y, 0.0, 1.0);\\n}\\n\"","import { __awaiter, __generator } from \"tslib\";\n\nvar Atlas =\n/** @class */\nfunction () {\n  function Atlas(gl, _name) {\n    this.gl = gl;\n    this._name = _name;\n    this._ready = false;\n    this._width = 0;\n    this._height = 0;\n    var texture = gl.createTexture();\n\n    if (!texture) {\n      throw new Error('Unable to create a new texture!');\n    }\n\n    this.texture = texture;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  }\n\n  Object.defineProperty(Atlas.prototype, \"name\", {\n    get: function get() {\n      return this._name;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Atlas.prototype, \"width\", {\n    get: function get() {\n      return this._width;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Atlas.prototype, \"height\", {\n    get: function get() {\n      return this._height;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Atlas.prototype, \"ready\", {\n    /**\n     * Return `true` as soon as an image has been loaded into the graphic card.\n     */\n    get: function get() {\n      return this._ready;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * Remove the texture from the graphic card memory.\n   */\n\n  Atlas.prototype.destroy = function () {\n    this._ready = false;\n\n    var _a = this,\n        gl = _a.gl,\n        texture = _a.texture;\n\n    gl.deleteTexture(texture);\n  };\n\n  Atlas.prototype.activate = function (unit) {\n    if (unit === void 0) {\n      unit = 0;\n    }\n\n    var _a = this,\n        gl = _a.gl,\n        texture = _a.texture;\n\n    var UNITS = [gl.TEXTURE0, gl.TEXTURE1, gl.TEXTURE2, gl.TEXTURE3, gl.TEXTURE4, gl.TEXTURE5, gl.TEXTURE6, gl.TEXTURE7];\n    gl.activeTexture(UNITS[Math.abs(unit) % UNITS.length]);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n  };\n  /**\n   * If you use canvas and you want to repaint this canvas, the atlas won't change.\n   * To force it to change, you have to call refresh().\n   */\n\n\n  Atlas.prototype.refresh = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this._params) return [2\n            /*return*/\n            ];\n            return [4\n            /*yield*/\n            , this.load(this._params)];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\n   * This function must not be called directly.\n   * It is used internally by painters.\n   */\n\n\n  Atlas.prototype.load = function (params) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        this._ready = false;\n        this._params = params;\n\n        if (params.image) {\n          return [2\n          /*return*/\n          , this.loadImage(params.image)];\n        } else if (params.canvas) {\n          return [2\n          /*return*/\n          , this.loadCanvas(params.canvas)];\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  Atlas.prototype.loadImage = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      var that;\n      return __generator(this, function (_a) {\n        that = this;\n        return [2\n        /*return*/\n        , new Promise(function (resolve, reject) {\n          var img = new Image();\n          that._ready = false;\n\n          img.onload = function () {\n            var gl = that.gl,\n                texture = that.texture;\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n            that._ready = true;\n            that._width = img.width;\n            that._height = img.height;\n            resolve();\n          };\n\n          img.onerror = function () {\n            console.error(\"Unable to load image \\\"\" + name + \"\\\": \", url);\n            reject();\n          };\n\n          img.src = url;\n        })];\n      });\n    });\n  };\n\n  Atlas.prototype.loadCanvas = function (canvas) {\n    var _a = this,\n        gl = _a.gl,\n        texture = _a.texture;\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\n    this._ready = true;\n    this._width = canvas.width;\n    this._height = canvas.height;\n  };\n\n  return Atlas;\n}();\n\nexport default Atlas;","var VIRTUAL_SCREEN_RESOLUTION = 1024;\nvar HALF = 0.5;\n\nvar Pointer =\n/** @class */\nfunction () {\n  /** @hidden */\n  function Pointer(canvas) {\n    var _this = this;\n\n    this._x = 0;\n    this._y = 0;\n    this._down = false; // If 0, pointer is up.\n\n    this._downTime = 0;\n    this._eventDown = false;\n    this._eventUp = false;\n\n    this.onMouseMove = function (evt) {\n      _this.computeCoords(evt.clientX, evt.clientY);\n    };\n\n    this.onTouchMove = function (te) {\n      var evt = te.touches[0];\n\n      _this.computeCoords(evt.clientX, evt.clientY);\n    };\n\n    this.onMouseDown = function (evt) {\n      _this.onDown(evt.clientX, evt.clientY);\n    };\n\n    this.onTouchStart = function (te) {\n      var evt = te.touches[0];\n\n      _this.onDown(evt.clientX, evt.clientY);\n    };\n\n    this.onMouseUp = function (evt) {\n      _this.onUp(evt.clientX, evt.clientY);\n    };\n\n    this.onTouchEnd = function (te) {\n      var evt = te.touches[0];\n\n      _this.onUp(evt.clientX, evt.clientY);\n    };\n\n    this.canvas = canvas;\n    window.addEventListener('mousemove', this.onMouseMove, true);\n    window.addEventListener('touchmove', this.onTouchMove, true);\n    window.addEventListener('mousedown', this.onMouseDown, true);\n    window.addEventListener('touchstart', this.onTouchStart, true);\n    window.addEventListener('mouseup', this.onMouseUp, true);\n    window.addEventListener('touchend', this.onTouchEnd, true);\n  }\n  /** @hidden */\n\n\n  Pointer.prototype.reset = function () {\n    this._eventDown = false;\n    this._eventUp = false;\n  };\n\n  Object.defineProperty(Pointer.prototype, \"x\", {\n    get: function get() {\n      return this._x;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Pointer.prototype, \"y\", {\n    get: function get() {\n      return this._y;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Pointer.prototype, \"down\", {\n    /** Test if the pointer is touching the screen. */\n    get: function get() {\n      return this._down;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Pointer.prototype, \"eventUp\", {\n    /** `true` only if the pointer started touching the screen this very last frame. */\n    get: function get() {\n      return this._eventUp;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Pointer.prototype, \"eventDown\", {\n    /** `true` only if the pointer stopped touching the screen this very last frame. */\n    get: function get() {\n      return this._eventDown;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Pointer.prototype.onDown = function (x, y) {\n    if (this._downTime !== 0) {\n      return;\n    }\n\n    this.computeCoords(x, y);\n    this._down = true;\n    this._eventDown = true;\n    this._downTime = Date.now();\n  };\n\n  Pointer.prototype.onUp = function (x, y) {\n    if (this._downTime === 0) {\n      return;\n    }\n\n    this.computeCoords(x, y);\n    this._down = false;\n    this._eventUp = true;\n    this._downTime = 0;\n  };\n\n  Pointer.prototype.computeCoords = function (pointerX, pointerY) {\n    var canvas = this.canvas;\n    var rect = canvas.getBoundingClientRect();\n    var x = pointerX - rect.left;\n    var y = pointerY - rect.top;\n    var w = rect.width;\n    var h = rect.height;\n\n    if (w > h) {\n      this._x = VIRTUAL_SCREEN_RESOLUTION * x / w;\n      this._y = VIRTUAL_SCREEN_RESOLUTION * (HALF * (1 - h / w) + y / w);\n    } else {\n      this._x = VIRTUAL_SCREEN_RESOLUTION * (HALF * (1 - w / h) + x / h);\n      this._y = VIRTUAL_SCREEN_RESOLUTION * y / h;\n    }\n  };\n\n  return Pointer;\n}();\n\nexport default Pointer;","/**\n * Resolution in CSS pixels. If omitted, the real resolution\n * of the device is taken. On smartphones, for instance,\n * the resolution is often greater than 1.\n *\n * Return `true` if the size has changed.\n */\nexport default (function (gl, _resolution) {\n  if (_resolution === void 0) {\n    _resolution = 0;\n  }\n\n  var resolution = _resolution <= 0 ? window.devicePixelRatio : _resolution;\n  var canvas = gl.canvas;\n\n  if (canvas instanceof HTMLCanvasElement) {\n    var displayWidth = Math.floor(canvas.clientWidth * resolution);\n    var displayHeight = Math.floor(canvas.clientHeight * resolution); // Check if the canvas is not the same size.\n\n    if (canvas.width !== displayWidth || canvas.height !== displayHeight) {\n      // Make the canvas the same size\n      canvas.width = displayWidth;\n      canvas.height = displayHeight;\n      gl.viewport(0, 0, displayWidth, displayHeight);\n      return true;\n    }\n  }\n\n  return false;\n});","import { __values } from \"tslib\";\nimport Atlas from './atlas';\nimport Pointer from './pointer';\nimport Resize from './webgl/resize';\nvar ID = 1;\n\nvar Scene =\n/** @class */\nfunction () {\n  function Scene(canvas) {\n    var _this = this;\n\n    this.resolution = 1;\n    this.onAnimation = null;\n    this.activePainters = [];\n    this.isRendering = false;\n    this.lastRenderingTime = 0;\n\n    this.render = function (time) {\n      var e_1, _a;\n\n      if (_this.isRendering) {\n        window.requestAnimationFrame(_this.render);\n      } else {\n        return;\n      }\n\n      var _b = _this,\n          gl = _b.gl,\n          lastRenderingTime = _b.lastRenderingTime;\n      Resize(gl, _this.resolution);\n      _this.lastRenderingTime = time;\n      var delta = time - lastRenderingTime;\n      gl.clearDepth(-1);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      gl.depthFunc(gl.GEQUAL);\n\n      try {\n        try {\n          for (var _c = __values(_this.activePainters), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var painter = _d.value;\n            painter.render(time, delta);\n          }\n        } catch (e_1_1) {\n          e_1 = {\n            error: e_1_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_1) throw e_1.error;\n          }\n        }\n\n        var onAnimation = _this.onAnimation;\n\n        if (typeof onAnimation === 'function') {\n          onAnimation(time);\n\n          _this.pointer.reset();\n        }\n      } catch (ex) {\n        console.error(ex);\n\n        _this.stop();\n\n        console.error('###############################');\n        console.error('# Rendering has been stopped! #');\n        console.error('###############################');\n      }\n    };\n\n    this._pointer = new Pointer(canvas);\n    var gl = canvas.getContext('webgl', {// Specify WebGL options.\n    });\n\n    if (!gl) {\n      throw new Error('Unable to create a WegGL context!');\n    }\n\n    this._gl = gl;\n    this.atlases = new Map();\n  }\n\n  Object.defineProperty(Scene.prototype, \"gl\", {\n    get: function get() {\n      return this._gl;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scene.prototype, \"pointer\", {\n    /**\n     * Retreive information about pointer (mouse, pen, finger, ...) state.\n     */\n    get: function get() {\n      return this._pointer;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scene.prototype, \"width\", {\n    /**\n     * Visible width. Between 0 and 1024.\n     */\n    get: function get() {\n      return this.gl.drawingBufferWidth;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Scene.prototype, \"height\", {\n    /**\n     * Visible height. Between 0 and 1024.\n     */\n    get: function get() {\n      return this.gl.drawingBufferHeight;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\n   * Define which painter to use and in what order.\n   * For better performance, prefer putting background painters at the end of the list.\n   */\n\n  Scene.prototype.use = function (painters) {\n    var e_2, _a;\n\n    try {\n      for (var painters_1 = __values(painters), painters_1_1 = painters_1.next(); !painters_1_1.done; painters_1_1 = painters_1.next()) {\n        var painter = painters_1_1.value;\n        painter.scene = this;\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (painters_1_1 && !painters_1_1.done && (_a = painters_1.return)) _a.call(painters_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    this.activePainters = painters.slice();\n  };\n\n  Scene.prototype.getAtlas = function (name) {\n    var atlases = this.atlases;\n    return atlases.get(name) || null;\n  };\n  /**\n   * Create an atlas that can be used immediatly even if the needed assets are not yet loaded.\n   * @param  params\n   * @param  onLoad You can provide a callback function that will be called when the assets\n   * are loaded.\n   */\n\n\n  Scene.prototype.createAtlas = function (params, onLoad) {\n    var name = params.name;\n    var sanitizedName = name || this.getNewName();\n    var atlas = new Atlas(this.gl, sanitizedName);\n    this.atlases.set(sanitizedName, atlas); // tslint:disable:no-floating-promises\n\n    atlas.load(params).then(function () {\n      if (typeof onLoad === 'function') {\n        onLoad(params);\n      }\n    });\n    return atlas;\n  };\n  /**\n   * Create an atlas that can be used immediatly even if the needed assets are not yet loaded.\n   * @param  params\n   * @param  onLoad You can provide a callback function that will be called when the assets\n   * are loaded.\n   */\n\n\n  Scene.prototype.createAtlasAsync = function (params) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var name = params.name;\n\n      var sanitizedName = name || _this.getNewName();\n\n      var atlas = new Atlas(_this.gl, sanitizedName);\n\n      _this.atlases.set(sanitizedName, atlas); // tslint:disable:no-floating-promises\n\n\n      atlas.load(params).then(function () {\n        return resolve(atlas);\n      });\n    });\n  };\n\n  Scene.prototype.createAtlasesAsync = function (params) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var e_3, _a;\n\n      var atlasNames = Object.keys(params);\n      var promises = [];\n\n      try {\n        for (var atlasNames_1 = __values(atlasNames), atlasNames_1_1 = atlasNames_1.next(); !atlasNames_1_1.done; atlasNames_1_1 = atlasNames_1.next()) {\n          var atlasName = atlasNames_1_1.value;\n          var atlasParam = params[atlasName];\n          promises.push(_this.createAtlasAsync(atlasParam));\n        }\n      } catch (e_3_1) {\n        e_3 = {\n          error: e_3_1\n        };\n      } finally {\n        try {\n          if (atlasNames_1_1 && !atlasNames_1_1.done && (_a = atlasNames_1.return)) _a.call(atlasNames_1);\n        } finally {\n          if (e_3) throw e_3.error;\n        }\n      }\n\n      Promise.all(promises).then(function (atlases) {\n        var result = {};\n\n        for (var i = 0; i < atlases.length; i++) {\n          var name_1 = atlasNames[i];\n          var atlas = atlases[i];\n          result[name_1] = atlas;\n        }\n\n        resolve(result);\n      });\n    });\n  };\n\n  Scene.prototype.destroyAtlas = function (name) {\n    var atlases = this.atlases;\n    var atlas = atlases.get(name);\n\n    if (!atlas) {\n      return false;\n    }\n\n    atlases.delete(name);\n    atlas.destroy();\n    return true;\n  };\n  /**\n   * Start rendering.\n   * When a frame is rendered, the function `onAnimation( time: number )` is called.\n   */\n\n\n  Scene.prototype.start = function () {\n    if (this.isRendering) {\n      return;\n    }\n\n    this.isRendering = true;\n    window.requestAnimationFrame(this.render);\n  };\n  /**\n   * Stop rendering.\n   */\n\n\n  Scene.prototype.stop = function () {\n    this.isRendering = false;\n  };\n\n  Scene.prototype.getNewName = function () {\n    while (true) {\n      var name_2 = \"atlas-\" + ID++;\n\n      if (!this.atlases.has(name_2)) {\n        return name_2;\n      }\n    }\n  };\n\n  return Scene;\n}();\n\nexport default Scene;","import { __extends } from \"tslib\";\nimport Calc from './calc';\nimport Camera from './camera';\nimport Painter from './painter';\nimport Scene from './scene';\n\nvar IScene =\n/** @class */\nfunction (_super) {\n  __extends(IScene, _super);\n\n  function IScene() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return IScene;\n}(Scene);\n\nexport { IScene };\nexport default {\n  Calc: Calc,\n  Camera: Camera,\n  Painter: Painter,\n  Scene: Scene\n};"],"sourceRoot":""}