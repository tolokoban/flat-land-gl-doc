(this.webpackJsonptest=this.webpackJsonptest||[]).push([[13],{10:function(t,e,r){"use strict";var n=r(3),i=r(7),o=r(5),a=r(4),s=r(6),c=r(0),u=r.n(c),l=(r(17),function(t){function e(){var t,r;Object(n.a)(this,e);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(r=Object(o.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(s)))).handleClick=function(){console.log("Click!"),r.props.onClick()},r}return Object(s.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return u.a.createElement("button",{className:"Button thm-ele-button thm-bgS",onClick:this.handleClick},this.props.label)}}]),e}(u.a.Component));r.d(e,"a",(function(){return l}))},12:function(t,e,r){"use strict";var n=r(3),i=r(7),o=r(5),a=r(4),s=r(6),c=r(0),u=r.n(c),l=function(t){function e(){var t,r;Object(n.a)(this,e);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(r=Object(o.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(s)))).ref=u.a.createRef(),r}return Object(s.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this.ref.current;t&&this.props.init(t)}},{key:"render",value:function(){return u.a.createElement("canvas",{ref:this.ref,className:"Canvas"})}}]),e}(u.a.Component),f=r(11),h=r(16),p=r(10),d=(r(18),function(t){function e(t){var r;return Object(n.a)(this,e),(r=Object(o.a)(this,Object(a.a)(e).call(this,t))).handleToggle=function(){console.info("this.state=",r.state),r.setState({visible:!r.state.visible})},r.state={visible:!1},r}return Object(s.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){var t=this.props,e=t.preContent,r=t.codeContent,n=t.postContent;return u.a.createElement("div",{className:["view-Page"].join(" ")},u.a.createElement("header",{className:"thm-ele-nav thm-bgP"},u.a.createElement(p.a,{label:"back",onClick:function(){return window.history.back()}}),u.a.createElement("div",null,this.props.title),u.a.createElement(p.a,{label:"doc.",onClick:this.handleToggle})),u.a.createElement(l,{init:this.props.onLoad}),u.a.createElement("div",{className:this.state.visible?"desc-show":"desc-hide"},e&&u.a.createElement(f.a,{options:{forceBlock:!0}},e),r&&u.a.createElement(h.a,{languages:["js"]},r),n&&u.a.createElement(f.a,{options:{forceBlock:!0}},n)))}}]),e}(u.a.Component));r.d(e,"a",(function(){return d}))},13:function(t,e,r){},14:function(t,e,r){},15:function(t,e,r){"use strict";r.r(e);var n=r(0),i=r.n(n),o=r(9),a=r.n(o),s=(r(13),r(14),function(){return i.a.createElement("div",{className:"App"},i.a.createElement("h1",null,"Tutorials"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{href:"tutorial/clear.html"},"Hello world!")),i.a.createElement("li",null,i.a.createElement("a",{href:"tutorial/background.html"},"Scalable background")),i.a.createElement("li",null,i.a.createElement("a",{href:"tutorial/sprites-1.html"},"Sprites")),i.a.createElement("li",null,i.a.createElement("a",{href:"tutorial/sprites-2.html"},"Quads")),i.a.createElement("li",null,i.a.createElement("a",{href:"tutorial/voronoi.html"},"Voronoi"))),i.a.createElement("h1",null,"Articles"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{href:"article/voronoi.html"},"Voronoi"))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(i.a.createElement(s,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},17:function(t,e,r){},18:function(t,e,r){},19:function(t,e,r){t.exports=r(22)},20:function(t,e,r){"use strict";function n(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function s(t){n(a,i,o,s,c,"next",t)}function c(t){n(a,i,o,s,c,"throw",t)}s(void 0)}))}}r.d(e,"a",(function(){return i}))},22:function(t,e,r){var n=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(t,e,r){var n=l;return function(i,o){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return L()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=R(a,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=u(t,e,r);if("normal"===c.type){if(n=r.done?p:f,c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=p,r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(n){return{type:"throw",arg:n}}}t.wrap=c;var l="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function m(){}function v(){}function y(){}var g={};g[o]=function(){return this};var b=Object.getPrototypeOf,_=b&&b(b(O([])));_&&_!==r&&n.call(_,o)&&(g=_);var w=y.prototype=m.prototype=Object.create(g);function A(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function E(t){var e;this._invoke=function(r,i){function o(){return new Promise((function(e,o){!function e(r,i,o,a){var s=u(t[r],t,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"===typeof l&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(t){e("next",t,o,a)}),(function(t){e("throw",t,o,a)})):Promise.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return e("throw",t,o,a)}))}a(s.arg)}(r,i,e,o)}))}return e=e?e.then(o,o):o()}}function R(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,R(t,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=u(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function B(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}return{next:L}}function L(){return{value:e,done:!0}}return v.prototype=w.constructor=y,y.constructor=v,y[s]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},A(E.prototype),E.prototype[a]=function(){return this},t.AsyncIterator=E,t.async=function(e,r,n,i){var o=new E(c(e,r,n,i));return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},A(w),w[s]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),B(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;B(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=n}catch(i){Function("r","regeneratorRuntime = r")(n)}},233:function(t,e,r){r(15),t.exports=r(270)},270:function(t,e,r){"use strict";r.r(e);var n=r(19),i=r.n(n);function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(c){i=!0,o=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var a=r(20),s=r(0),c=r.n(s),u=r(9),l=r.n(u),f=r(8),h=r(33),p=r.n(h),d=r(34),m=r.n(d),v=r(12);function y(){return(y=Object(a.a)(i.a.mark((function t(e){var r,n,a,s,c,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new f.a.Scene(e),t.next=3,r.createAtlasesAsync({background:{image:m.a},sprites:{image:p.a}});case 3:n=t.sent,a=new f.a.Camera.Cover2D({size:1024}),s=new f.a.Painter.Sprites({camera:a,atlas:n.sprites}),c=new f.a.Painter.Background({atlas:n.background,align:"B"}),u=s.createQuad({}),r.onAnimation=function(t){var e=o(g(-256,256,256,t,.001234),2),r=e[0],n=e[1],i=o(g(256,256,256,t+10,.002034),2),a=i[0],s=i[1],c=o(g(256,-256,256,t-7,.001034),2),l=c[0],f=c[1],h=o(g(-256,-256,256,t+3,.001724),2),p=h[0],d=h[1];u.update({xTL:r,yTL:n,xTR:a,yTR:s,xBR:l,yBR:f,xBL:p,yBL:d})},r.use([s,c]),r.start();case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t,e,r,n,i){var o=n*i;return[t+r*Math.cos(o),e+r*Math.sin(o)]}l.a.render(c.a.createElement(v.a,{title:"Quads in motion",codeContent:'function start() {\n  const scene = new FlatLand.Scene(canvas)\n  const spritesAtlas = scene.createAtlas({\n      image: SpriteAtlas\n  })\n  const backgroundAtlas = scene.createAtlas({\n      image: BackgroundAtlas\n  })\n  const spritesPainter = new FlatLand.Painter.Sprites({\n      atlas: spritesAtlas,\n  })\n  const backgroundPainter = new FlatLand.Painter.Background({\n      atlas: backgroundAtlas,\n      align: "B"\n  })\n\n  const quad = spritesPainter.createQuad({})\n\n  scene.onAnimation = (time) => {\n    const [xTL, yTL] = rotate(0, 0, 512, time, 0.001234)\n    const [xTR, yTR] = rotate(0, 0, 512, time, 0.001234)\n    const [xBR, yBR] = rotate(0, 0, 512, time, 0.001234)\n    const [xBL, yBL] = rotate(0, 0, 512, time, 0.001234)\n    quad.update({\n      xTL, yTL, xTR, yTR, xBR, yBR, xBL, yBL\n    })\n  }\n  scene.use([spritesPainter, backgroundPainter])\n  scene.start()\n}\n\nfunction rotate(centerX, centerY, radius, time, seed) {\n  const ang = time * seed\n  return [\n    centerX + radius * Math.cos(ang),\n    centerY + radius * Math.sin(ang)\n  ]\n}\n',onLoad:function(t){return y.apply(this,arguments)}}),document.getElementById("root"))},33:function(t,e,r){t.exports=r.p+"static/media/atlas.1eb3cdac.png"},34:function(t,e,r){t.exports=r.p+"static/media/background.0935ef34.png"},8:function(t,e,r){"use strict";for(var n=r(1),i=4095,o=new Float32Array(4096),a=new Float32Array(4096),s=0;s<4096;s++){var c=Math.PI*s/2048;o[s]=Math.cos(c),a[s]=Math.sin(c)}var u={cos:function(t){return o[(0|t)&i]},sin:function(t){return a[(0|t)&i]},clamp:function(t,e,r){void 0===e&&(e=0);void 0===r&&(r=1);return t<e?e:t>r?r:t}};var l=function(){function t(){}return t.prototype.getShaderIncludes=function(){var t=this;return{cameraUniforms:Object.keys(this.glslUniforms).map((function(e){return"uniform "+t.glslUniforms[e]+" "+e+";\n"})).join(""),cameraFunction:this.glslFunction}},t}(),f={Silly:function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(n.c)(e,t),Object.defineProperty(e.prototype,"glslUniforms",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glslFunction",{get:function(){return"vec4 worldPointToScreen(vec3 point) {\n    return vec4(point, 1.0);\n}"},enumerable:!0,configurable:!0}),e.prototype.setUniformValues=function(){},e}(l),Cover2D:function(t){function e(e){var r=t.call(this)||this;return r.zoom=1,r.x=0,r.y=0,r.params=Object(n.a)({size:1024},e),r}return Object(n.c)(e,t),Object.defineProperty(e.prototype,"glslUniforms",{get:function(){return{uniCameraInvertedScale:"float",uniCameraScaleX:"float",uniCameraScaleY:"float",uniCameraX:"float",uniCameraY:"float"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glslFunction",{get:function(){return"vec4 worldPointToScreen(vec3 point) {\n    return vec4((point.x - uniCameraX) * uniCameraScaleX,\n                (point.y - uniCameraY) * uniCameraScaleY,\n                point.z,\n                /*uniCameraInvertedScale **/ "+(this.params.size/2).toFixed(1)+");\n}"},enumerable:!0,configurable:!0}),e.prototype.setUniformValues=function(t,e,r){e>r?(t.uniforms.uniCameraScaleX=1,t.uniforms.uniCameraScaleY=e/r):(t.uniforms.uniCameraScaleX=r/e,t.uniforms.uniCameraScaleY=1),t.uniforms.uniCameraX=this.x,t.uniforms.uniCameraY=this.y;var n=this.zoom;if(0===n)t.uniforms.uniCameraInvertedScale=1;else{var i=1/n;t.uniforms.uniCameraInvertedScale=i}},e}(l)};function h(t,e){void 0===e&&(e="");var r=typeof t;return"number"!==r||isNaN(t)?"string"===r?t:e:""+t}var p=Float32Array.BYTES_PER_ELEMENT,d=function(){function t(t,e,r){var i,o;void 0===r&&(r={});var a=function(t,e){return{vert:m(t.vert,e),frag:m(t.frag,e)}}(e,r);this.gl=t,Object.freeze(this.gl),this.BPE=p,Object.freeze(this.BPE),this._typesNamesLookup=function(t){var e={};for(var r in t)if(r===r.toUpperCase()){var n=t[r];"number"===typeof n&&(e[n]=r)}return e}(t);var s=t.createProgram();if(!s)throw Error("Unable to create WebGLProgram!");this.program=s;var c=function(t,e){return v(t.VERTEX_SHADER,t,e)}(t,a.vert);t.attachShader(s,c);var u=function(t,e){return v(t.FRAGMENT_SHADER,t,e)}(t,a.frag);t.attachShader(s,u),t.linkProgram(s),this.use=function(){t.useProgram(s)},this.attribs=this.createAttributes(),this.uniforms={},this.uniformsLocation=this.createUniformsLocation();try{for(var l=Object(n.f)(Object.keys(a)),f=l.next();!f.done;f=l.next()){var h=f.value;console.log(">>> Shader: ",h),console.log(a[h])}}catch(d){i={error:d}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}return t.prototype.use=function(){this.gl.useProgram(this.program)},t.prototype.getTypeName=function(t){return this._typesNamesLookup[t]},t.prototype.bindAttribs=function(t){for(var e,r,i,o,a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];var c=this,u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,t);var l=0;try{for(var f=Object(n.f)(a),h=f.next();!h.done;h=f.next()){var d=h.value;if(!(b=c.attribs[d]))throw Error('Cannot find attribute "'+d+"!\nIt may be not active because unused in the shader.\nAvailable attributes are: "+Object.keys(c.attribs).map((function(t){return'"'+t+'"'})).join(", ")+" ("+String(c.attribs.length)+")");l+=b.size*b.length*p}}catch(_){e={error:_}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(e)throw e.error}}var m=0;try{for(var v=Object(n.f)(a),y=v.next();!y.done;y=v.next()){var g=y.value,b=c.attribs[g];u.enableVertexAttribArray(b.location),u.vertexAttribPointer(b.location,b.size*b.length,u.FLOAT,!1,l,m),m+=b.size*b.length*p}}catch(w){i={error:w}}finally{try{y&&!y.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}},t.prototype.setUniform=function(t,e){var r=this.uniforms,n=this.uniformsLocation;if("undefined"===typeof n[t]){console.error('Uniform "'+t+'" does not exist in this WebGL Program!');var i=Object.keys(n);throw 0===i.length?console.error("Actually, this program has no uniform at all."):console.error("Available uniforms are:",i.join(", ")),Error('Uniform "'+t+'" was ot found!')}r[t]=e},t.prototype.createAttributes=function(){for(var t=this.gl,e=this.program,r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=t.getActiveAttrib(e,i);o&&(o.typeName=this.getTypeName(o.type),o.length=this.getSize(t,o),o.location=t.getAttribLocation(e,o.name),r[o.name]=o,Object.defineProperty(this,""+o.name,{value:o.location,writable:!1,enumerable:!0,configurable:!1}))}return r},t.prototype.getSize=function(t,e){switch(e.type){case t.FLOAT_VEC4:return 4;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC2:return 2;case t.FLOAT:return 1;default:throw Error("[webgl.program:getSize] I don't know the size of the attribute \""+e.name+'" because I don\'t know the type "'+this.getTypeName(e.type)+'"!')}},t.prototype.createUniformsLocation=function(){for(var t=this.gl,e=this.program,r=this.uniforms,n={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;o<i;o++){var a=t.getActiveUniform(e,o);if(a){var s=y(a.name),c=t.getUniformLocation(e,a.name);c&&(n[s]=c,Object.defineProperty(r,""+s,{set:this.createUniformSetter(a,n[s],this._typesNamesLookup),get:this.createUniformGetter(a),enumerable:!0,configurable:!1}))}}return n},t.prototype.createUniformSetter=function(t,e,r){var n=this.gl,i="_"+y(t.name);switch(t.type){case n.BYTE:case n.UNSIGNED_BYTE:case n.SHORT:case n.UNSIGNED_SHORT:case n.INT:case n.UNSIGNED_INT:case n.SAMPLER_2D:return 1===t.size?function(t){n.uniform1i(e,t),this[i]=t}:function(t){n.uniform1iv(e,t),this[i]=t};case n.FLOAT:return 1===t.size?function(t){n.uniform1f(e,t),this[i]=t}:function(t){n.uniform1fv(e,t),this[i]=t};case n.FLOAT_VEC2:if(1===t.size)return function(t){n.uniform2fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform \""+t.name+'"!');case n.FLOAT_VEC3:if(1===t.size)return function(t){n.uniform3fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform \""+t.name+'"!');case n.FLOAT_VEC4:if(1===t.size)return function(t){n.uniform4fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform \""+t.name+'"!');case n.FLOAT_MAT3:if(1===t.size)return function(t){n.uniformMatrix3fv(e,!1,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform \""+t.name+'"!');case n.FLOAT_MAT4:if(1===t.size)return function(t){n.uniformMatrix4fv(e,!1,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform \""+t.name+'"!');default:throw Error("[webgl.program.createWriter] Don't know how to deal with uniform \""+t.name+'" of type '+r[t.type]+"!")}},t.prototype.createUniformGetter=function(t){var e="_"+t.name;return function(){return this[e]}},t}();function m(t,e){return t.split("\n").map((function(t){if(!t.trim().startsWith("#include"))return t;var r=t.indexOf("#include")+"#include".length,n=t.substr(r).trim();"'<\"".indexOf(n.charAt(0))>-1&&(n=n.substr(1,n.length-"<>".length));var i=e[n];if("string"!==typeof i)throw console.error("Include <"+n+"> not found in ",e),Error("Include not found in shader: "+n);return i})).join("\n")}function v(t,e,r){if(t!==e.VERTEX_SHADER&&t!==e.FRAGMENT_SHADER)throw Error("Type must be VERTEX_SHADER or FRAGMENT_SHADER!");var n=e.createShader(t);if(!n)throw Error("Unable to create a "+(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" shader!");if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(n)||"NULL";throw console.error("An error occurred compiling the shader: "+i),console.info(function(t,e){var r=t.split(/\n\r?/);r.unshift(""),g.lastIndex=-1;var n=g.exec(e);if(!n)return t;for(var i=Number(n[2]),o=Math.max(1,i-2),a=Math.min(r.length-1,i+2),s=[],c=o;c<=a;c++)s.push(c+":    "+r[c]);return s.join("\n")}(r,i)),Error("Unable to create a "+(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" shader!")}return n}function y(t){var e=t.indexOf("[");return-1===e?t:t.substr(0,e)}var g=/ERROR: ([0-9]+):([0-9]+):/g;var b=function(){function t(){this._programs=[],this._scene=null}return Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},set:function(t){t!==this._scene&&(this._scene&&this.internalDestroy(this._scene),this._scene=t,t&&this.initialize(t))},enumerable:!0,configurable:!0}),t.prototype.createProgram=function(t,e){void 0===e&&(e={});var r=this._scene;if(!r)throw Error("This painter has no scene!\ncreateProfram() should only be called from initialize().");var n=new d(r.gl,t,e);return this._programs.push(n),n},t.prototype.fatal=function(t){return console.error("Fatal error in Painter:",t),new Error(t)},t.prototype.internalDestroy=function(t){var e,r,i=t.gl;try{for(var o=Object(n.f)(this._programs),a=o.next();!a.done;a=o.next()){var s=a.value;i.deleteProgram(s)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}},t}(),_=function(t){function e(e){var r=t.call(this)||this;return r.params=e,r}return Object(n.c)(e,t),e.prototype.render=function(){var t=this.scene,e=this.prg,r=this.atlas,n=this.buff;if(t&&e&&r&&n){var i=t.gl;i.enable(i.DEPTH_TEST),e.use(),r.activate(),e.$uniTexture=0,e.setUniform("uniAspectRatio",t.width/t.height),e.bindAttribs(n,"attXY"),i.bindBuffer(i.ARRAY_BUFFER,n),i.drawArrays(i.TRIANGLE_STRIP,0,4)}},e.prototype.destroy=function(t){var e=t.gl,r=this.buff;r&&e.deleteBuffer(r)},e.prototype.initialize=function(t){var e=this.params,r=e.atlas;this.atlas=r,this.prg=this.createProgram({frag:A,vert:w(h(e.align).toUpperCase())});var n=t.gl,i=n.createBuffer();if(!i)throw this.fatal("Not enough memory to create an array buffer!");n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),n.STATIC_DRAW),this.buff=i},e}(b);function w(t){var e="",r="";return-1!==t.indexOf("B")?r="location.y -= uniAspectRatio - 1.0;":-1!==t.indexOf("T")&&(r="location.y += uniAspectRatio - 1.0;"),-1!==t.indexOf("R")?e="location.x -= 1.0 / uniAspectRatio - 1.0;":-1!==t.indexOf("L")&&(e="location.x += 1.0 / uniAspectRatio - 1.0;"),"uniform float uniAspectRatio;\nattribute vec2 attXY;\nvarying vec2 varUV;\n\nvoid main() {\n  varUV = attXY;\n  vec2 location = 2.0 * (attXY - vec2(0.5, 0.5));\n\n  if (uniAspectRatio > 1.0) {\n    location.y *= uniAspectRatio;"+r+"\n  } else {\n    location.x /= uniAspectRatio;"+e+"\n  }\n\n  gl_Position = vec4(location.x, -location.y, -1.0, 1.0);\n}"}var A="precision mediump float;\nuniform sampler2D uniTexture;\nvarying vec2 varUV;\n\nvoid main() {\n  vec4 color = texture2D( uniTexture, varUV );\n  gl_FragColor = color;\n}",E=["#RGB".length,"#RGBA".length,"#RRGGBB".length,"#RRGGBBAA".length],R=/^#[0-9A-F]+$/gi,T=function(){function t(t){void 0===t&&(t="#000000"),this.R=0,this.G=0,this.B=0,this.H=0,this.S=0,this.L=0,this.A=1,this.parse(t)}return t.isValid=function(t){var e,r;if(R.lastIndex=-1,!R.test(t))return!1;try{for(var i=Object(n.f)(E),o=i.next();!o.done;o=i.next()){var a=o.value;if(t.length===a)return!0}}catch(s){e={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return!1},t.normalize=function(e){return new t(e).stringify()},t.luminance=function(e){return new t(e).luminance()},t.luminanceStep=function(e){return new t(e).luminanceStep()},t.fromArrayRGB=function(e){var r=Object(n.e)(e,3),i=r[0],o=r[1],a=r[2];return t.newRGB(i,o,a)},t.fromArrayRGBA=function(e){var r=Object(n.e)(e,4),i=r[0],o=r[1],a=r[2],s=r[3];return t.newRGBA(i,o,a,s)},t.mix=function(e,r,n){void 0===n&&(n=.5);var i=1-n;return t.newRGBA(n*r.R+i*e.R,n*r.G+i*e.G,n*r.B+i*e.B,n*r.A+i*e.A)},t.ramp=function(e,r){if(void 0===r&&(r=.5),0===e.length)return t.newBlack();if(1===e.length)return e[0];var n=e.length-1,i=Math.floor(r*n),o=e[i];if(i===n)return o;var a=e[i+1],s=i+r/n;return t.mix(o,a,s)},t.newBlack=function(){return t.newRGB(0,0,0)},t.newWhite=function(){return t.newRGB(1,1,1)},t.newRGB=function(e,r,n){var i=new t;return i.R=e,i.G=r,i.B=n,i.A=1,i},t.newRGBA=function(e,r,n,i){var o=new t;return o.R=e,o.G=r,o.B=n,o.A=i,o},t.prototype.toArrayRGB=function(){return[this.R,this.G,this.B]},t.prototype.toArrayRGBA=function(){return[this.R,this.G,this.B,this.A]},t.prototype.parse=function(t){void 0===t&&(t="#000000");var e=t.trim().toUpperCase();return!!this.parseHexa.call(this,e)||(!!this.parseRGB.call(this,e)||(!!this.parseRGBA.call(this,e)||!!this.parseHSL.call(this,e)))},t.prototype.luminance=function(){return.2126*this.R+.7152*this.G+.0722*this.B},t.prototype.luminanceStep=function(){return this.luminance()<.6?0:1},t.prototype.stringify=function(){var t=C(255*this.R)+C(255*this.G)+C(255*this.B);return this.A<1&&(t+=C(255*this.A)),"#"+t},t.prototype.copy=function(){var e=new t;return e.R=this.R,e.G=this.G,e.B=this.B,e.A=this.A,e.H=this.H,e.S=this.S,e.L=this.L,e},t.prototype.hsl2rgb=function(){var t=6*this.H,e=this.S,r=this.L,n=(1-Math.abs(2*r-1))*e,i=n*(1-Math.abs(t%2-1)),o=0,a=0,s=0;t<3?t<1?(o=n,a=i,s=0):t<2?(o=i,a=n,s=0):(o=0,a=n,s=i):t<4?(o=0,a=i,s=n):t<5?(o=i,a=0,s=n):(o=n,a=0,s=i);var c=r-.5*n;this.R=o+c,this.G=a+c,this.B=s+c},t.prototype.rgb2hsl=function(){var t=this.R,e=this.G,r=this.B,n=Math.min(t,e,r),i=Math.max(t,e,r),o=i-n;this.L=.5*(i+n),o<1e-6?(this.H=0,this.S=0):(this.S=o/(1-Math.abs(2*this.L-1)),this.H=i===t?e>=r?B*((e-r)/o):1-B*((r-e)/o):i===e?B*(2+(r-t)/o):B*(4+(t-e)/o))},t.prototype.parseHexa=function(t){if("#"!==t.charAt(0))return!1;var e=0,r=0,n=0,i=1;switch(t.length){case 4:e=parseInt(t.charAt(1),16)*x,r=parseInt(t.charAt(2),16)*x,n=parseInt(t.charAt(3),16)*x;break;case 5:e=parseInt(t.charAt(1),16)*x,r=parseInt(t.charAt(2),16)*x,n=parseInt(t.charAt(3),16)*x,i=parseInt(t.charAt(4),16)*x;break;case 7:e=parseInt(t.substr(1,2),16)*L,r=parseInt(t.substr(3,2),16)*L,n=parseInt(t.substr(5,2),16)*L;break;case 9:e=parseInt(t.substr(1,2),16)*L,r=parseInt(t.substr(3,2),16)*L,n=parseInt(t.substr(5,2),16)*L,i=parseInt(t.substr(7,2),16)*L}return isNaN(e)||isNaN(r)||isNaN(n)||isNaN(i)?this.R=this.G=this.B=this.A=0:(this.R=e,this.G=r,this.B=n,this.A=i),!0},t.prototype.parseRGB=function(t){var e=U.exec(t);return!!e&&(this.R=F(parseInt(e[1],10)*L),this.G=F(parseInt(e[2],10)*L),this.B=F(parseInt(e[3],10)*L),this.A=1,!0)},t.prototype.parseRGBA=function(t){var e=j.exec(t);return!!e&&(this.R=F(parseInt(e[1],10)*L),this.G=F(parseInt(e[2],10)*L),this.B=F(parseInt(e[3],10)*L),this.A=F(parseFloat(e[4])),!0)},t.prototype.parseHSL=function(t){var e=P.exec(t);return!!e&&(this.H=F(parseInt(e[1],10)*S),this.S=F(parseInt(e[2],10)*O),this.L=F(parseInt(e[3],10)*O),this.A=1,this.hsl2rgb(),!0)},t}(),B=1/6,x=1/15,O=1/99,L=1/255,S=1/359,U=/^RGB[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/,j=/^RGBA[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)[^0-9.]+([0-9.]+)/,P=/^HSL[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;function F(t){return t<0?0:t>1?1:t}function C(t){var e=Math.floor(t).toString(16);return e.length<2&&(e="0"+e),e}var N=function(t){function e(e){var r=t.call(this)||this;return r.params=e,r._red=.8,r._green=.4,r._blue=.2,r._alpha=1,r}return Object(n.c)(e,t),Object.defineProperty(e.prototype,"red",{get:function(){return this._red},set:function(t){this._red=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"green",{get:function(){return this._green},set:function(t){this._green=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blue",{get:function(){return this._blue},set:function(t){this._blue=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){var t=new T;return t.R=this._red,t.G=this._green,t.B=this._blue,t.A=this._alpha,t.stringify()},set:function(t){var e=new T(t);this._red=e.R,this._green=e.G,this._blue=e.B,this._alpha=e.A},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t=this.scene;if(t){var e=t.gl;e.clearColor(this._red,this._green,this._blue,this._alpha),e.clear(e.COLOR_BUFFER_BIT)}},e.prototype.initialize=function(){this.params&&(this.color=this.params.color||"#d72")},e.prototype.destroy=function(){},e}(b),I=function(){function t(t,e,r,n){this.$index=-1,this.extra={},this._id=t,this._data=e,this._update=r,this._destroy=n}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._destroy(this)},t}(),D=function(t){function e(e,r,n,i,o){var a=t.call(this,e,r,n,i)||this;return a._params=o,a}return Object(n.c)(e,t),e.prototype.update=function(t){t&&(this._params=Object(n.a)(Object(n.a)({},this._params),t));var e=this._params,r=e.xTL,i=e.yTL,o=e.zTL,a=e.uTL,s=e.vTL,c=e.xTR,u=e.yTR,l=e.zTR,f=e.uTR,h=e.vTR,p=e.xBR,d=e.yBR,m=e.zBR,v=e.uBR,y=e.vBR,g=e.xBL,b=e.yBL,_=e.zBL,w=e.uBL,A=e.vBL,E=this._data;E[0]=r,E[1]=i,E[2]=o,E[3]=a,E[4]=s,E[5]=c,E[6]=u,E[7]=l,E[8]=f,E[9]=h,E[10]=p,E[11]=d,E[12]=m,E[13]=v,E[14]=y,E[15]=g,E[16]=b,E[17]=_,E[18]=w,E[19]=A,this._update(this,E)},e}(I),G=function(t){function e(e,r,n,i,o){var a=t.call(this,e,r,n,i)||this;return a._params=o,a}return Object(n.c)(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._params.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._params.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._params.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._params.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._params.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originX",{get:function(){return this._params.originX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originY",{get:function(){return this._params.originY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"u0",{get:function(){return this._params.u0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"v0",{get:function(){return this._params.v0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"u1",{get:function(){return this._params.u1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"v1",{get:function(){return this._params.v1},enumerable:!0,configurable:!0}),e.prototype.update=function(t){t&&(this._params=Object(n.a)(Object(n.a)({},this._params),t));var e=this._params,r=e.x,i=e.y,o=e.z,a=e.originX,s=e.originY,c=e.width,l=e.height,f=e.u0,h=e.v0,p=e.u1,d=e.v1,m=e.scale,v=e.angle,y=-a,g=-s,b=y+c,_=g,w=y+c,A=g+l,E=y,R=g+l,T=y*m,B=g*m,x=b*m,O=_*m,L=w*m,S=A*m,U=E*m,j=R*m;if(0!==(0|v)){var P=u.cos(v),F=u.sin(v);T=(y*P+g*F)*m,B=(g*P-y*F)*m,x=(b*P+_*F)*m,O=(_*P-b*F)*m,L=(w*P+A*F)*m,S=(A*P-w*F)*m,U=(E*P+R*F)*m,j=(R*P-E*F)*m}var C=this._data;C[0]=T+r,C[1]=B+i,C[2]=o,C[3]=f,C[4]=d,C[5]=x+r,C[6]=O+i,C[7]=o,C[8]=p,C[9]=d,C[10]=L+r,C[11]=S+i,C[12]=o,C[13]=p,C[14]=h,C[15]=U+r,C[16]=j+i,C[17]=o,C[18]=f,C[19]=h,this._update(this,C)},e}(I),k=64,M=6,X=4,Y=5*X,V=1,z=function(t){function e(e){var r=t.call(this)||this;return r._capacity=k,r._dataVert=new Float32Array(k*Y),r._sprites=[],r._update=function(t,e){r.scene?(t.$index<0&&r._allocate(t),r._dataVert.set(e,Y*t.$index)):r._deferedSpritesUpdate.set(t.id,[t,e])},r._destroy=function(t){var e=r._sprites.pop();e?(e.$index!==t.$index&&(e.$index=t.$index,r._sprites[e.$index]=e,e.update()),t.$index=-1):console.error("You tried to destroy a Sprite that is not owned by this painter!",t)},r._atlas=e.atlas,r._camera=e.camera,r._deferedSpritesUpdate=new Map,r}return Object(n.c)(e,t),Object.defineProperty(e.prototype,"atlas",{get:function(){return this._atlas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._sprites.length},enumerable:!0,configurable:!0}),e.prototype.createSprite=function(t){var e=this.atlas,r=e.width||64,i=e.height||64,o=new Float32Array(Y),a=new G(""+V++,o,this._update,this._destroy,Object(n.a)({x:0,y:0,z:0,width:r,height:i,originX:.5*r,originY:.5*r,u0:0,v0:0,u1:1,v1:1,scale:1,angle:0},t));return a.update(),a},e.prototype.createQuad=function(t){var e=new Float32Array(Y),r=new D(""+V++,e,this._update,this._destroy,Object(n.a)({xTL:0,yTL:0,zTL:0,uTL:0,vTL:0,xTR:1024,yTR:0,zTR:0,uTR:1,vTR:0,xBR:1024,yBR:1024,zBR:0,uBR:1,vBR:1,xBL:0,yBL:1024,zBL:0,uBL:0,vBL:1},t));return r.update(),r},e.prototype._allocate=function(t){this._capacity<=this.count&&this._allocateNewBlock(),t.$index=this.count,this._sprites.push(t)},e.prototype._allocateNewBlock=function(){this._capacity+=k;var t=this.scene,e=this._buffElem;if(!t)throw Error("No scene!");if(!e)throw Error("No buffElem!");var r=t.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),r.bufferData(r.ELEMENT_ARRAY_BUFFER,q(this._capacity),r.DYNAMIC_DRAW);var n=new Float32Array(this._capacity*Y);n.set(this._dataVert),this._dataVert=n},e.prototype.render=function(t,e){var r=this,n=r.scene,i=r._prg,o=r.atlas,a=r._buffVert,s=r._buffElem,c=r._camera;if(n&&i&&o&&a&&s){var u=n.gl;u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,this._dataVert,u.DYNAMIC_DRAW),u.enable(u.DEPTH_TEST),i.use(),c.setUniformValues(i,n.width,n.height,t,e),o.activate(),i.$uniTexture=0,i.bindAttribs(a,"attXYZ","attUV"),u.bindBuffer(u.ARRAY_BUFFER,a),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),u.drawElements(u.TRIANGLES,M*this.count,u.UNSIGNED_SHORT,0)}},e.prototype.initialize=function(t){this._prg=this.createProgram({vert:"uniform float uniWidth;\nuniform float uniHeight;\n\nattribute vec3 attXYZ;\nattribute vec2 attUV;\n\nvarying vec2 varUV;\n\n#include cameraUniforms\n#include cameraFunction\n\nvoid main() {\n  varUV = attUV;\n  gl_Position = worldPointToScreen(attXYZ);\n}\n",frag:"precision mediump float;\nuniform sampler2D uniTexture;\nvarying vec2 varUV;\n\nvoid main() {\n  vec4 color = texture2D( uniTexture, varUV );\n  if (color.a < 1.0) discard;\n  gl_FragColor = color;\n}\n"},this._camera.getShaderIncludes());var e=t.gl,r=e.createBuffer();if(!r)throw this.fatal("Not enough memory to create an array buffer!");e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,this._dataVert,e.DYNAMIC_DRAW),this._buffVert=r;var n=e.createBuffer();if(!n)throw this.fatal("Not enough memory to create an array buffer!");e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,q(k),e.DYNAMIC_DRAW),this._buffElem=n,this.manageDeferedSpritesUpdates()},e.prototype.destroy=function(){var t=this.scene,e=this._buffVert,r=this._buffElem;if(t&&e&&r){var n=t.gl;n.deleteBuffer(e),n.deleteBuffer(r)}},e.prototype.manageDeferedSpritesUpdates=function(){var t,e;if(0!==this._deferedSpritesUpdate.size)try{for(var r=Object(n.f)(this._deferedSpritesUpdate.values()),i=r.next();!i.done;i=r.next()){var o=i.value,a=Object(n.e)(o,2),s=a[0],c=a[1];this._update(s,c)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e}(b),H=1,W=2,$=3;function q(t){for(var e=new Uint16Array(M*t),r=0,n=0,i=0;i<t;i++){var o=n+H,a=n+W,s=n+$;e[r+0]=n,e[r+1]=s,e[r+2]=o,e[r+3]=o,e[r+4]=s,e[r+5]=a,n+=X,r+=M}return e}function Q(t){for(var e=[],r=0;r<3*t;r++)e.push(Math.random());return e}var Z={Background:_,Clear:N,Painter:b,Sprites:z,Voronoi:function(t){function e(e){var r=t.call(this)||this;if(r.params=Object(n.a)({seeds:Q(20),colors:Q(20),border:0,light:0,scaleX:1,scaleY:1},e),r.params.seeds.length%3!==0)throw Error('The length of "seeds" must be an integral multiple of 3!');if(r.params.seeds.length!==r.params.colors.length)throw Error('"seeds" and "colors" must have the same length!');return r.seeds=new Float32Array(r.params.seeds),r.colors=new Float32Array(r.params.colors),r}return Object(n.c)(e,t),e.prototype.render=function(){var t=this.scene,e=this.prg,r=this.buff;if(t&&e&&r){var n=this.params,i=n.border,o=n.scaleX,a=n.scaleY,s=i,c=t.gl;c.enable(c.DEPTH_TEST),e.use(),e.setUniform("uniSeeds",this.seeds),e.setUniform("uniColors",this.colors),e.setUniform("uniLight",this.params.light),e.setUniform("uniThickness",s),e.setUniform("uniScaleX",o),e.setUniform("uniScaleY",a),e.bindAttribs(r,"attXY"),c.bindBuffer(c.ARRAY_BUFFER,r),c.drawArrays(c.TRIANGLE_STRIP,0,4)}},e.prototype.destroy=function(t){var e=t.gl,r=this.buff;r&&e.deleteBuffer(r)},e.prototype.initialize=function(t){this.prg=this.createProgram({frag:'precision mediump float;\n\n#include "count"\n\nconst vec3 WHITE = vec3(1,1,1);\nconst vec3 BLACK = vec3(0,0,0);\n\nuniform float uniSeeds[COUNT];\nuniform float uniColors[COUNT];\nuniform float uniLight;\nuniform float uniThickness;\n\n/**\n * The coords of a and b must be in the range [0;1].\n */\nfloat distSquared(vec2 a, vec2 b) {\n  float x = abs(a.x - b.x);\n  if (x > .5) x = 1.0 - x;\n  float y = abs(a.y - b.y);\n  if (y > .5) y = 1.0 - y;\n\n  return x*x + y*y;\n}\n\nvarying vec2 varUV;\n\nvoid main() {\n  vec2 M = vec2(fract(varUV.x), fract(varUV.y));\n\n  float distA = distSquared(M, vec2(uniSeeds[0], uniSeeds[1])) * uniSeeds[2];\n  vec3 seedA = vec3(uniSeeds[0], uniSeeds[1], uniSeeds[2]);\n  vec3 colorA = vec3(uniColors[0], uniColors[1], uniColors[2]);\n  float distB = distSquared(M, vec2(uniSeeds[3], uniSeeds[4])) * uniSeeds[5];\n  vec3 seedB = vec3(uniSeeds[3], uniSeeds[4], uniSeeds[5]);\n  vec3 colorB = vec3(uniColors[3], uniColors[4], uniColors[5]);\n\n  if (distB < distA) {\n    float swaperDist = distA;\n    distA = distB;\n    distB = swaperDist;\n    vec3 swaperSeed = seedA;\n    seedA = seedB;\n    seedB = swaperSeed;\n    vec3 swaperColor = colorA;\n    colorA = colorB;\n    colorB = swaperColor;\n  }\n\n  float dist;\n  vec3 seed;\n  vec3 color;\n\n  for (int i = 6; i < COUNT; i+=3) {\n    seed = vec3(uniSeeds[i], uniSeeds[i+1], uniSeeds[i+2]);\n    color = vec3(uniColors[i], uniColors[i+1], uniColors[i+2]);\n    dist = distSquared(M, seed.xy) * seed.z;\n    if (dist < distA) {\n      distB = distA;\n      seedB = seedA;\n      colorB = colorA;\n      distA = dist;\n      seedA = seed;\n      colorA = color;\n    }\n    else if (dist < distB) {\n      distB = dist;\n      seedB = seed;\n      colorB = color;\n    }\n  }\n\n/*\n  vec2 AM = M.xy - seedA.xy;\n  vec2 AB = seedB.xy - seedA.xy;\n  vec2 AB1 = normalize(AB);\n  float semiLengthAB = length(AB) * 0.5;\n  float distanceFromBorder = semiLengthAB - dot(AM, AB1);\n*/\n\n  float dA = distA;\n  float dB = distB;\n  float distanceFromBorder = dB - dA;\n  float alpha;\n  vec3 color0;\n  vec3 color1;\n\n  if (distanceFromBorder < uniThickness) {\n      // Border.\n      color0 = BLACK;\n      color1 = colorA;\n      alpha = smoothstep(0.0, uniThickness, distanceFromBorder);\n  } else {\n      // Cell.\n      color0 = colorA;\n      color1 = mix(colorA, WHITE, uniLight);\n      alpha = (distanceFromBorder - uniThickness) / (dB - uniThickness);\n  }\n\n  gl_FragColor = vec4(mix(color0, color1, alpha), 1);\n}\n',vert:"uniform float uniScaleX;\nuniform float uniScaleY;\n\nattribute vec2 attXY;\nvarying vec2 varUV;\n\nvoid main() {\n  varUV = vec2(attXY.x * uniScaleX, attXY.y * uniScaleY);\n  float x = (attXY.x * 2.0) - 1.0;\n  float y = 1.0 - (attXY.y * 2.0);\n  gl_Position = vec4(x, y, 0.0, 1.0);\n}\n"},{count:"const int COUNT = "+this.params.seeds.length+";"});var e=t.gl,r=e.createBuffer();if(!r)throw this.fatal("Not enough memory to create an array buffer!");e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW),this.buff=r},e}(b)},J=function(){function t(t,e){this.gl=t,this._name=e,this._ready=!1,this._width=0,this._height=0;var r=t.createTexture();if(!r)throw new Error("Unable to create a new texture!");this.texture=r,t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._ready=!1;var t=this.gl,e=this.texture;t.deleteTexture(e)},t.prototype.activate=function(t){void 0===t&&(t=0);var e=this.gl,r=this.texture,n=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7];e.activeTexture(n[Math.abs(t)%n.length]),e.bindTexture(e.TEXTURE_2D,r)},t.prototype.refresh=function(){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(t){switch(t.label){case 0:return this._params?[4,this.load(this._params)]:[2];case 1:return t.sent(),[2]}}))}))},t.prototype.load=function(t){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(e){return this._ready=!1,this._params=t,t.image?[2,this.loadImage(t.image)]:t.canvas?[2,this.loadCanvas(t.canvas)]:[2]}))}))},t.prototype.loadImage=function(t){return Object(n.b)(this,void 0,void 0,(function(){var e;return Object(n.d)(this,(function(r){return e=this,[2,new Promise((function(r,n){var i=new Image;e._ready=!1,i.onload=function(){var t=e.gl,n=e.texture;t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),e._ready=!0,e._width=i.width,e._height=i.height,r()},i.onerror=function(){console.error('Unable to load image "'+name+'": ',t),n()},i.src=t}))]}))}))},t.prototype.loadCanvas=function(t){var e=this.gl,r=this.texture;e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),this._ready=!0,this._width=t.width,this._height=t.height},t}(),K=function(){function t(t){var e=this;this._x=0,this._y=0,this._down=!1,this._downTime=0,this._eventDown=!1,this._eventUp=!1,this.onMouseMove=function(t){e.computeCoords(t.clientX,t.clientY)},this.onTouchMove=function(t){var r=t.touches[0];e.computeCoords(r.clientX,r.clientY)},this.onMouseDown=function(t){e.onDown(t.clientX,t.clientY)},this.onTouchStart=function(t){var r=t.touches[0];e.onDown(r.clientX,r.clientY)},this.onMouseUp=function(t){e.onUp(t.clientX,t.clientY)},this.onTouchEnd=function(t){var r=t.touches[0];e.onUp(r.clientX,r.clientY)},this.canvas=t,window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mousedown",this.onMouseDown,!0),window.addEventListener("touchstart",this.onTouchStart,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("touchend",this.onTouchEnd,!0)}return t.prototype.reset=function(){this._eventDown=!1,this._eventUp=!1},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"down",{get:function(){return this._down},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventUp",{get:function(){return this._eventUp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDown",{get:function(){return this._eventDown},enumerable:!0,configurable:!0}),t.prototype.onDown=function(t,e){0===this._downTime&&(this.computeCoords(t,e),this._down=!0,this._eventDown=!0,this._downTime=Date.now())},t.prototype.onUp=function(t,e){0!==this._downTime&&(this.computeCoords(t,e),this._down=!1,this._eventUp=!0,this._downTime=0)},t.prototype.computeCoords=function(t,e){var r=this.canvas.getBoundingClientRect(),n=t-r.left,i=e-r.top,o=r.width,a=r.height;o>a?(this._x=1024*n/o,this._y=1024*(.5*(1-a/o)+i/o)):(this._x=1024*(.5*(1-o/a)+n/a),this._y=1024*i/a)},t}(),tt=function(t,e){void 0===e&&(e=0);var r=e<=0?window.devicePixelRatio:e,n=t.canvas;if(n instanceof HTMLCanvasElement){var i=Math.floor(n.clientWidth*r),o=Math.floor(n.clientHeight*r);if(n.width!==i||n.height!==o)return n.width=i,n.height=o,t.viewport(0,0,i,o),!0}return!1},et=1,rt=function(){function t(t){var e=this;this.resolution=1,this.onAnimation=null,this.activePainters=[],this.isRendering=!1,this.lastRenderingTime=0,this.render=function(t){var r,i;if(e.isRendering){window.requestAnimationFrame(e.render);var o=e,a=o.gl,s=o.lastRenderingTime;tt(a,e.resolution),e.lastRenderingTime=t;var c=t-s;a.clearDepth(-1),a.clear(a.DEPTH_BUFFER_BIT),a.depthFunc(a.GEQUAL);try{try{for(var u=Object(n.f)(e.activePainters),l=u.next();!l.done;l=u.next()){l.value.render(t,c)}}catch(h){r={error:h}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}var f=e.onAnimation;"function"===typeof f&&(f(t),e.pointer.reset())}catch(p){console.error(p),e.stop(),console.error("###############################"),console.error("# Rendering has been stopped! #"),console.error("###############################")}}},this._pointer=new K(t);var r=t.getContext("webgl",{});if(!r)throw new Error("Unable to create a WegGL context!");this._gl=r,this.atlases=new Map}return Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointer",{get:function(){return this._pointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.gl.drawingBufferWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.gl.drawingBufferHeight},enumerable:!0,configurable:!0}),t.prototype.use=function(t){var e,r;try{for(var i=Object(n.f)(t),o=i.next();!o.done;o=i.next()){o.value.scene=this}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}this.activePainters=t.slice()},t.prototype.getAtlas=function(t){return this.atlases.get(t)||null},t.prototype.createAtlas=function(t,e){var r=t.name||this.getNewName(),n=new J(this.gl,r);return this.atlases.set(r,n),n.load(t).then((function(){"function"===typeof e&&e(t)})),n},t.prototype.createAtlasAsync=function(t){var e=this;return new Promise((function(r){var n=t.name||e.getNewName(),i=new J(e.gl,n);e.atlases.set(n,i),i.load(t).then((function(){return r(i)}))}))},t.prototype.createAtlasesAsync=function(t){var e=this;return new Promise((function(r){var i,o,a=Object.keys(t),s=[];try{for(var c=Object(n.f)(a),u=c.next();!u.done;u=c.next()){var l=u.value,f=t[l];s.push(e.createAtlasAsync(f))}}catch(h){i={error:h}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}Promise.all(s).then((function(t){for(var e={},n=0;n<t.length;n++){var i=a[n],o=t[n];e[i]=o}r(e)}))}))},t.prototype.destroyAtlas=function(t){var e=this.atlases,r=e.get(t);return!!r&&(e.delete(t),r.destroy(),!0)},t.prototype.start=function(){this.isRendering||(this.isRendering=!0,window.requestAnimationFrame(this.render))},t.prototype.stop=function(){this.isRendering=!1},t.prototype.getNewName=function(){for(;;){var t="atlas-"+et++;if(!this.atlases.has(t))return t}},t}();(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Object(n.c)(e,t)})(rt),e.a={Calc:u,Camera:f,Painter:Z,Scene:rt}}},[[233,9,0,1]]]);
//# sourceMappingURL=sprites-2.da02626.5fac55f1.chunk.js.map