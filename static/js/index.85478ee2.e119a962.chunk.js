(this.webpackJsonptest=this.webpackJsonptest||[]).push([[4],[,,function(t,e){!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="./src/index.ts")}({"./src/atlas.ts":function(t,e,r){"use strict";r.r(e);var n=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(e){o(e)}}function s(t){try{u(n.throw(t))}catch(e){o(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=function(){function t(t,e){this.gl=t,this._name=e,this._ready=!1,this._width=0,this._height=0;var r=t.createTexture();if(!r)throw new Error("Unable to create a new texture!");this.texture=r,t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._ready=!1;var t=this.gl,e=this.texture;t.deleteTexture(e)},t.prototype.activate=function(t){void 0===t&&(t=0);var e=this.gl,r=this.texture,n=[e.TEXTURE0,e.TEXTURE1,e.TEXTURE2,e.TEXTURE3,e.TEXTURE4,e.TEXTURE5,e.TEXTURE6,e.TEXTURE7];e.activeTexture(n[Math.abs(t)%n.length]),e.bindTexture(e.TEXTURE_2D,r)},t.prototype.load=function(t){return n(this,void 0,void 0,(function(){return i(this,(function(e){return this._ready=!1,[2,this.loadImage(t.image)]}))}))},t.prototype.loadImage=function(t){return n(this,void 0,void 0,(function(){var e;return i(this,(function(r){return e=this,[2,new Promise((function(r,n){var i=new Image;e._ready=!1,i.onload=function(){var t=e.gl,n=e.texture;t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),e._ready=!0,e._width=i.width,e._height=i.height,r()},i.onerror=function(){console.error('Unable to load image "'+name+'": ',t),n()},i.src=t}))]}))}))},t}();e.default=o},"./src/calc.ts":function(t,e,r){"use strict";r.r(e);for(var n=new Float32Array(4096),i=new Float32Array(4096),o=0;o<4096;o++){var a=Math.PI*o/2048;n[o]=Math.cos(a),i[o]=Math.sin(a)}e.default={cos:function(t){return n[4095&(0|t)]},sin:function(t){return i[4095&(0|t)]}}},"./src/converter/string.ts":function(t,e,r){"use strict";function n(t,e){void 0===e&&(e="");var r=typeof t;return"number"!==r||isNaN(t)?"string"===r?t:e:""+t}r.r(e),r.d(e,"default",(function(){return n}))},"./src/index.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/calc.ts"),i=r("./src/painter/index.ts"),o=r("./src/scene.ts"),a={Calc:n.default,Painter:i.default,Scene:o.default};e.default=a,window.FlatLand=a},"./src/painter/background/background.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/converter/string.ts"),i=r("./src/painter/painter.ts"),o=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),a=function(t){function e(e){var r=t.call(this)||this;return r.params=e,r}return o(e,t),e.prototype.destroy=function(t){var e=t.gl,r=this.buff;e.deleteBuffer(r)},e.prototype.initialize=function(t){var e=this.params,r=e.atlas,i=t.getAtlas(r);if(!i)throw this.fatal('Atlas "'+r+'" not found!');this.atlas=i,this.prg=this.createProgram({frag:u,vert:s(Object(n.default)(e.align).toUpperCase())});var o=t.gl,a=o.createBuffer();if(!a)throw this.fatal("Not enough memory to create an array buffer!");o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),o.STATIC_DRAW),this.buff=a},e.prototype.render=function(){var t=this.scene,e=this.prg,r=this.atlas,n=this.buff;if(t){var i=t.gl;i.enable(i.DEPTH_TEST),e.use(),r.activate(),e.$uniTexture=0,e.setUniform("uniAspectRatio",t.width/t.height),e.bindAttribs(n,"attXY"),i.bindBuffer(i.ARRAY_BUFFER,n),i.drawArrays(i.TRIANGLE_STRIP,0,4)}},e}(i.default);function s(t){var e="",r="";return-1!==t.indexOf("B")?r="location.y -= uniAspectRatio - 1.0;":-1!==t.indexOf("T")&&(r="location.y += uniAspectRatio - 1.0;"),-1!==t.indexOf("R")?e="location.x -= 1.0 / uniAspectRatio - 1.0;":-1!==t.indexOf("L")&&(e="location.x += 1.0 / uniAspectRatio - 1.0;"),"uniform float uniAspectRatio;\nattribute vec2 attXY;\nvarying vec2 varUV;\n\nvoid main() {\n  varUV = attXY;\n  vec2 location = 2.0 * (attXY - vec2(0.5, 0.5));\n\n  if (uniAspectRatio > 1.0) {\n    location.y *= uniAspectRatio;"+r+"\n  } else {\n    location.x /= uniAspectRatio;"+e+"\n  }\n\n  gl_Position = vec4(location.x, -location.y, -1.0, 1.0);\n}"}e.default=a;var u="precision mediump float;\nuniform sampler2D uniTexture;\nvarying vec2 varUV;\n\nvoid main() {\n  vec4 color = texture2D( uniTexture, varUV );\n  gl_FragColor = color;\n}"},"./src/painter/background/index.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/painter/background/background.ts");r.d(e,"default",(function(){return n.default}))},"./src/painter/clear.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/webgl/color.ts"),i=r("./src/painter/painter.ts"),o=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),a=function(t){function e(e){var r=t.call(this)||this;return r.params=e,r._red=.8,r._green=.4,r._blue=.2,r._alpha=1,r}return o(e,t),e.prototype.initialize=function(){this.params&&(this.color=this.params.color||"#d72")},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"red",{get:function(){return this._red},set:function(t){this._red=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"green",{get:function(){return this._green},set:function(t){this._green=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blue",{get:function(){return this._blue},set:function(t){this._blue=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){var t=new n.default;return t.R=this._red,t.G=this._green,t.B=this._blue,t.A=this._alpha,t.stringify()},set:function(t){var e=new n.default(t);this._red=e.R,this._green=e.G,this._blue=e.B,this._alpha=e.A},enumerable:!0,configurable:!0}),e.prototype.render=function(){var t=this.scene;if(t){var e=t.gl;e.clearColor(this._red,this._green,this._blue,this._alpha),e.clear(e.COLOR_BUFFER_BIT)}},e}(i.default);e.default=a},"./src/painter/index.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/painter/background/index.ts"),i=r("./src/painter/clear.ts"),o=r("./src/painter/painter.ts"),a=r("./src/painter/sprites/index.ts");e.default={Background:n.default,Clear:i.default,Painter:o.default,Sprites:a.default}},"./src/painter/painter.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/webgl/program.ts"),i=function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(){function t(){this._programs=[],this._scene=null}return Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},set:function(t){t!==this._scene&&(this._scene&&this.internalDestroy(this._scene),this._scene=t,t&&this.initialize(t))},enumerable:!0,configurable:!0}),t.prototype.internalDestroy=function(t){var e,r,n=t.gl;try{for(var o=i(this._programs),a=o.next();!a.done;a=o.next()){var s=a.value;n.deleteProgram(s)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}},t.prototype.createProgram=function(t,e){void 0===e&&(e={});var r=this._scene;if(!r)throw Error("This painter has no scene!\ncreateProfram() should only be called from initialize().");var i=new n.default(r.gl,t,e);return this._programs.push(i),i},t.prototype.fatal=function(t){return console.error("Fatal error in Painter:",t),new Error(t)},t}();e.default=o},"./src/painter/sprites/index.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/painter/sprites/sprites.ts");r.d(e,"default",(function(){return n.default}))},"./src/painter/sprites/sprite.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/calc.ts"),i=function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o=function(){function t(t,e,r){this.getData=e,this.extra={},this.$index=0,this.$index=t;var n=r.width||50,o=r.height||50;this.params=i({x:0,y:0,z:0,width:n,height:o,originX:n/2,originY:o/2,u0:0,v0:0,u1:1,v1:1,scale:1,angle:0},r),this.update(this.params)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.params.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.params.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.params.z},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originX",{get:function(){return this.params.originX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originY",{get:function(){return this.params.originY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"u0",{get:function(){return this.params.u0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"v0",{get:function(){return this.params.v0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"u1",{get:function(){return this.params.u1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"v1",{get:function(){return this.params.v1},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.params=i(i({},this.params),t);var e=this.getData,r=this.$index,o=this.params,a=e(),s=o.x,u=o.y,c=o.z,f=o.originX,l=o.originY,h=o.width,p=o.height,d=o.u0,g=o.v0,y=o.u1,b=o.v1,m=o.scale,v=o.angle,w=-f,E=-l,_=w+h,A=E,R=w+h,T=E+p,O=w,x=E+p,B=w*m,P=E*m,U=_*m,S=A*m,j=R*m,I=T*m,N=O*m,D=x*m;if(0!==(0|v)){var F=n.default.cos(v),L=n.default.sin(v);B=(w*F+E*L)*m,P=(E*F-w*L)*m,U=(_*F+A*L)*m,S=(A*F-_*L)*m,j=(R*F+T*L)*m,I=(T*F-R*L)*m,N=(O*F+x*L)*m,D=(x*F-O*L)*m}a[r+0]=B+s,a[r+1]=P+u,a[r+2]=c,a[r+3]=d,a[r+4]=g,a[r+5]=U+s,a[r+6]=S+u,a[r+7]=c,a[r+8]=y,a[r+9]=g,a[r+10]=j+s,a[r+11]=I+u,a[r+12]=c,a[r+13]=y,a[r+14]=b,a[r+15]=N+s,a[r+16]=D+u,a[r+17]=c,a[r+18]=d,a[r+19]=b},t}();e.default=o},"./src/painter/sprites/sprites.frag":function(t,e,r){"use strict";r.r(e),e.default="precision mediump float;\nuniform sampler2D uniTexture;\nvarying vec2 varUV;\n\nvoid main() {\n  vec4 color = texture2D( uniTexture, varUV );\n  if (color.a < 1.0) discard;\n  gl_FragColor = color;\n}\n"},"./src/painter/sprites/sprites.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/painter/painter.ts"),i=r("./src/painter/sprites/sprite.ts"),o=r("./src/painter/sprites/sprites.frag"),a=r("./src/painter/sprites/sprites.vert"),s=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=64,f=24,l=function(t){function e(e){var r=t.call(this)||this;return r.params=e,r.dataVert=new Float32Array(c*f),r.sprites=[],r.count=0,r.capacity=c,r.getData=function(){return r.dataVert},r}return s(e,t),e.prototype.destroy=function(t){var e=t.gl,r=this.buffElem,n=this.buffVert;e.deleteBuffer(r),e.deleteBuffer(n)},e.prototype.initialize=function(t){var e=this.params.atlas;this.atlas=e,this.prg=this.createProgram({vert:a.default,frag:o.default});var r=t.gl,n=r.createBuffer();if(!n)throw this.fatal("Not enough memory to create an array buffer!");r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,this.dataVert,r.DYNAMIC_DRAW),this.buffVert=n;var i=r.createBuffer();if(!i)throw this.fatal("Not enough memory to create an array buffer!");r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),r.bufferData(r.ELEMENT_ARRAY_BUFFER,h(c),r.DYNAMIC_DRAW),this.buffElem=i},e.prototype.createSprite=function(t){var e=this.count*f;this.count++,this.count>=this.capacity&&this.allocateNewBlock();var r=this.atlas,n=r.width,o=r.height,a=new i.default(e,this.getData,u({width:n,height:o},t));return this.sprites.push(a),a},e.prototype.removeSprite=function(t){if(!(t.$index<0)){var e=this.sprites;if(0!==e.length){if(1===e.length)return t.$index=-1,e.splice(0,e.length),void(this.count=0);var r=e.pop();r&&(r.$index=t.$index,r.update({}),this.count--,t.$index=-1)}else t.$index=-1}},e.prototype.render=function(){var t=this,e=t.scene,r=t.prg,n=t.atlas,i=t.buffVert,o=t.buffElem;if(e){var a=e.gl;a.bindBuffer(a.ARRAY_BUFFER,i),a.bufferData(a.ARRAY_BUFFER,this.dataVert,a.DYNAMIC_DRAW),a.enable(a.DEPTH_TEST),r.use(),n.activate();var s=r;s.$uniTexture=0,s.$uniWidth=e.width,s.$uniHeight=e.height,r.bindAttribs(i,"attXYZ","attUV"),a.bindBuffer(a.ARRAY_BUFFER,i),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o),a.drawElements(a.TRIANGLES,6*this.count,a.UNSIGNED_SHORT,0)}},e.prototype.allocateNewBlock=function(){this.capacity+=c;var t=this.scene;if(!t)throw Error("No scene!");var e=t.gl,r=this.buffElem;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,h(this.capacity),e.DYNAMIC_DRAW);var n=new Float32Array(this.capacity*f);n.set(this.dataVert),this.dataVert=n},e}(n.default);function h(t){for(var e=new Uint16Array(6*t),r=0,n=0,i=0;i<t;i++){var o=n+1,a=n+2,s=n+3;e[r+0]=n,e[r+1]=s,e[r+2]=o,e[r+3]=o,e[r+4]=s,e[r+5]=a,n+=4,r+=6}return e}e.default=l},"./src/painter/sprites/sprites.vert":function(t,e,r){"use strict";r.r(e),e.default="uniform float uniWidth;\nuniform float uniHeight;\nattribute vec3 attXYZ;\nattribute vec2 attUV;\nvarying vec2 varUV;\n\nconst float RESOLUTION = 512.0;\nconst float INV_RESOLUTION = 1.0 / RESOLUTION;\n\nvoid main() {\n  varUV = attUV;\n  float widestSide = max(uniWidth, uniHeight);\n  float w = widestSide / uniWidth;\n  float h = widestSide / uniHeight;\n  float x = w * (attXYZ.x - RESOLUTION) * INV_RESOLUTION;\n  float y = h * (attXYZ.y - RESOLUTION) * INV_RESOLUTION;\n\n  gl_Position = vec4(x, -y, attXYZ.z, 1.0);\n}\n"},"./src/pointer.ts":function(t,e,r){"use strict";r.r(e);var n=function(){function t(t){var e=this;this.canvas=t,this._x=0,this._y=0,this._down=!1,this._downTime=0,this._eventDown=!1,this._eventUp=!1,this.onMouseMove=function(t){e.computeCoords(t.clientX,t.clientY)},this.onTouchMove=function(t){var r=t.touches[0];e.computeCoords(r.clientX,r.clientY)},this.onMouseDown=function(t){e.onDown(t.clientX,t.clientY)},this.onTouchStart=function(t){var r=t.touches[0];e.onDown(r.clientX,r.clientY)},this.onMouseUp=function(t){e.onUp(t.clientX,t.clientY)},this.onTouchEnd=function(t){var r=t.touches[0];e.onUp(r.clientX,r.clientY)},window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mousedown",this.onMouseDown,!0),window.addEventListener("touchstart",this.onTouchStart,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("touchend",this.onTouchEnd,!0)}return t.prototype.reset=function(){this._eventDown=!1,this._eventUp=!1},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"down",{get:function(){return this._down},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventUp",{get:function(){return this._eventUp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDown",{get:function(){return this._eventDown},enumerable:!0,configurable:!0}),t.prototype.onDown=function(t,e){0===this._downTime&&(this.computeCoords(t,e),this._down=!0,this._eventDown=!0,this._downTime=Date.now())},t.prototype.onUp=function(t,e){0!==this._downTime&&(this.computeCoords(t,e),this._down=!1,this._eventUp=!0,this._downTime=0)},t.prototype.computeCoords=function(t,e){var r=this.canvas.getBoundingClientRect(),n=t-r.left,i=e-r.top,o=r.width,a=r.height;o>a?(this._x=1024*n/o,this._y=1024*(.5*(1-a/o)+i/o)):(this._x=1024*(.5*(1-o/a)+n/a),this._y=1024*i/a)},t}();e.default=n},"./src/scene.ts":function(t,e,r){"use strict";r.r(e);var n=r("./src/atlas.ts"),i=r("./src/webgl/resize.ts"),o=r("./src/pointer.ts"),a=function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},s=1,u=function(){function t(t){var e=this;this.resolution=1,this.onAnimation=null,this.activePainters=[],this.isRendering=!1,this._pointerTap=!1,this.render=function(t){var r,n;if(e.isRendering){window.requestAnimationFrame(e.render);var o=e.gl;Object(i.default)(o,e.resolution),o.clearDepth(-1),o.clear(o.DEPTH_BUFFER_BIT),o.depthFunc(o.GEQUAL);try{try{for(var s=a(e.activePainters),u=s.next();!u.done;u=s.next()){u.value.render(t)}}catch(f){r={error:f}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var c=e.onAnimation;"function"===typeof c&&(c(t),e.pointer.reset())}catch(l){console.error(l),e.stop(),console.error("###############################"),console.error("# Rendering has been stopped! #"),console.error("###############################")}}},this._pointer=new o.default(t);var r=t.getContext("webgl",{});if(!r)throw new Error("Unable to create a WegGL context!");this._gl=r,this.atlases=new Map}return Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointer",{get:function(){return this._pointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.gl.drawingBufferWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.gl.drawingBufferHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerTap",{get:function(){return this._pointerTap},enumerable:!0,configurable:!0}),t.prototype.use=function(t){var e,r;try{for(var n=a(t),i=n.next();!i.done;i=n.next()){i.value.scene=this}}catch(o){e={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}this.activePainters=t.slice()},t.prototype.getAtlas=function(t){return this.atlases.get(t)||null},t.prototype.getNewName=function(){for(;;){var t="atlas-"+s++;if(!this.atlases.has(t))return t}},t.prototype.createAtlas=function(t){var e=t.name||this.getNewName(),r=new n.default(this.gl,e);return this.atlases.set(e,r),r.load(t),r},t.prototype.destroyAtlas=function(t){var e=this.atlases,r=e.get(t);return!!r&&(e.delete(t),r.destroy(),!0)},t.prototype.start=function(){this.isRendering||(this.isRendering=!0,window.requestAnimationFrame(this.render))},t.prototype.stop=function(){this.isRendering=!1},t}();e.default=u},"./src/webgl/color.ts":function(t,e,r){"use strict";r.r(e);var n=function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=function(){function t(t){void 0===t&&(t="#000000"),this.R=0,this.G=0,this.B=0,this.H=0,this.S=0,this.L=0,this.A=1,this.parse(t)}return t.isValid=function(t){if("string"!==typeof t)return!1;if("#"!==t.charAt(0))return!1;switch(t.length){case 4:case 5:case 7:case 9:return!0}return!1},t.normalize=function(e){return new t(e).stringify()},t.luminance=function(e){return new t(e).luminance()},t.luminanceStep=function(e){return new t(e).luminanceStep()},t.fromArrayRGB=function(t){var e=n(t,3),r=e[0],i=e[1],o=e[2];return this.newRGB(r,i,o)},t.fromArrayRGBA=function(t){var e=n(t,4),r=e[0],i=e[1],o=e[2],a=e[3];return this.newRGBA(r,i,o,a)},t.mix=function(e,r,n){void 0===n&&(n=.5);var i=1-n;return t.newRGBA(n*r.R+i*e.R,n*r.G+i*e.G,n*r.B+i*e.B,n*r.A+i*e.A)},t.ramp=function(e,r){if(void 0===r&&(r=.5),0===e.length)return t.newBlack();if(1===e.length)return e[0];var n=e.length-1,i=Math.floor(r*n),o=e[i];if(i===n)return o;var a=e[i+1],s=i+r/n;return t.mix(o,a,s)},t.newBlack=function(){return t.newRGB(0,0,0)},t.newWhite=function(){return t.newRGB(1,1,1)},t.newRGB=function(e,r,n){var i=new t;return i.R=e,i.G=r,i.B=n,i.A=1,i},t.newRGBA=function(e,r,n,i){var o=new t;return o.R=e,o.G=r,o.B=n,o.A=i,o},t.prototype.toArrayRGB=function(){return[this.R,this.G,this.B]},t.prototype.toArrayRGBA=function(){return[this.R,this.G,this.B,this.A]},t.prototype.parse=function(t){void 0===t&&(t="#000000");var e=t.trim().toUpperCase();return!!this.parseHexa.call(this,e)||(!!this.parseRGB.call(this,e)||(!!this.parseRGBA.call(this,e)||!!this.parseHSL.call(this,e)))},t.prototype.luminance=function(){return.2126*this.R+.7152*this.G+.0722*this.B},t.prototype.luminanceStep=function(){return this.luminance()<.6?0:1},t.prototype.stringify=function(){var t=d(255*this.R)+d(255*this.G)+d(255*this.B);return this.A<1&&(t+=d(255*this.A)),"#"+t},t.prototype.copy=function(){var e=new t;return e.R=this.R,e.G=this.G,e.B=this.B,e.A=this.A,e.H=this.H,e.S=this.S,e.L=this.L,e},t.prototype.hsl2rgb=function(){var t=6*this.H,e=this.S,r=this.L,n=(1-Math.abs(2*r-1))*e,i=n*(1-Math.abs(t%2-1)),o=0,a=0,s=0;t<3?t<1?(o=n,a=i,s=0):t<2?(o=i,a=n,s=0):(o=0,a=n,s=i):t<4?(o=0,a=i,s=n):t<5?(o=i,a=0,s=n):(o=n,a=0,s=i);var u=r-.5*n;this.R=o+u,this.G=a+u,this.B=s+u},t.prototype.rgb2hsl=function(){var t=this.R,e=this.G,r=this.B,n=Math.min(t,e,r),i=Math.max(t,e,r),a=i-n;this.L=.5*(i+n),a<1e-6?(this.H=0,this.S=0):(this.S=a/(1-Math.abs(2*this.L-1)),this.H=i===t?e>=r?o*((e-r)/a):1-o*((r-e)/a):i===e?o*(2+(r-t)/a):o*(4+(t-e)/a))},t.prototype.parseHexa=function(t){if("#"!==t.charAt(0))return!1;var e=0,r=0,n=0,i=1;switch(t.length){case 4:e=parseInt(t.charAt(1),16)*a,r=parseInt(t.charAt(2),16)*a,n=parseInt(t.charAt(3),16)*a;break;case 5:e=parseInt(t.charAt(1),16)*a,r=parseInt(t.charAt(2),16)*a,n=parseInt(t.charAt(3),16)*a,i=parseInt(t.charAt(4),16)*a;break;case 7:e=parseInt(t.substr(1,2),16)*u,r=parseInt(t.substr(3,2),16)*u,n=parseInt(t.substr(5,2),16)*u;break;case 9:e=parseInt(t.substr(1,2),16)*u,r=parseInt(t.substr(3,2),16)*u,n=parseInt(t.substr(5,2),16)*u,i=parseInt(t.substr(7,2),16)*u}return isNaN(e)||isNaN(r)||isNaN(n)||isNaN(i)?this.R=this.G=this.B=this.A=0:(this.R=e,this.G=r,this.B=n,this.A=i),!0},t.prototype.parseRGB=function(t){var e=f.exec(t);return!!e&&(this.R=p(parseInt(e[1],10)*u),this.G=p(parseInt(e[2],10)*u),this.B=p(parseInt(e[3],10)*u),this.A=1,!0)},t.prototype.parseRGBA=function(t){var e=l.exec(t);return!!e&&(this.R=p(parseInt(e[1],10)*u),this.G=p(parseInt(e[2],10)*u),this.B=p(parseInt(e[3],10)*u),this.A=p(parseFloat(e[4])),!0)},t.prototype.parseHSL=function(t){var e=h.exec(t);return!!e&&(this.H=p(parseInt(e[1],10)*c),this.S=p(parseInt(e[2],10)*s),this.L=p(parseInt(e[3],10)*s),this.A=1,this.hsl2rgb(),!0)},t}();e.default=i;var o=1/6,a=1/15,s=1/99,u=1/255,c=1/359,f=/^RGB[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/,l=/^RGBA[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)[^0-9.]+([0-9.]+)/,h=/^HSL[\s(]+([0-9]+)[^0-9]+([0-9]+)[^0-9]+([0-9]+)/;function p(t){return t<0?0:t>1?1:t}function d(t){var e=Math.floor(t).toString(16);return e.length<2&&(e="0"+e),e}},"./src/webgl/program.ts":function(t,e,r){"use strict";r.r(e);var n=function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},i=Float32Array.BYTES_PER_ELEMENT,o=function(){function t(t,e,r){if(void 0===r&&(r={}),"string"!==typeof e.vert)throw Error("[webgl.program] Missing attribute `vert` in argument `codes`!");if("string"!==typeof e.frag)throw Error("[webgl.program] Missing attribute `frag` in argument `codes`!");e=function(t,e){return{vert:a(t.vert,e),frag:a(t.frag,e)}}(e,r),this.gl=t,Object.freeze(this.gl),this.BPE=i,Object.freeze(this.BPE),this._typesNamesLookup=function(t){var e={};for(var r in t)if(r===r.toUpperCase()){var n=t[r];"number"===typeof n&&(e[n]=r)}return e}(t);var n=t.createProgram();if(!n)throw Error("Unable to create WebGLProgram!");this.program=n;var o=function(t,e){return s(t.VERTEX_SHADER,t,e)}(t,e.vert);t.attachShader(n,o);var u=function(t,e){return s(t.FRAGMENT_SHADER,t,e)}(t,e.frag);t.attachShader(n,u),t.linkProgram(n),this.use=function(){t.useProgram(n)},this.attribs=this.createAttributes(),this.uniforms=this.createUniforms()}return t.prototype.use=function(){this.gl.useProgram(this.program)},t.prototype.getTypeName=function(t){return this._typesNamesLookup[t]},t.prototype.bindAttribs=function(t){for(var e,r,o,a,s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];var c=this,f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,t);var l=0;try{for(var h=n(s),p=h.next();!p.done;p=h.next()){var d=p.value;if(!(v=c.attribs[d]))throw Error('Cannot find attribute "'+d+'"!\nIt may be not active because unused in the shader.\nAvailable attributes are: '+Object.keys(c.attribs).map((function(t){return'"'+t+'"'})).join(", ")+" ("+c.attribs.length+")");l+=v.size*v.length*i}}catch(w){e={error:w}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}var g=0;try{for(var y=n(s),b=y.next();!b.done;b=y.next()){var m=b.value,v=c.attribs[m];f.enableVertexAttribArray(v.location),f.vertexAttribPointer(v.location,v.size*v.length,f.FLOAT,!1,l,g),g+=v.size*v.length*i}}catch(E){o={error:E}}finally{try{b&&!b.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}},t.prototype.setUniform=function(t,e){this["$"+t]=e},t.prototype.createAttributes=function(){for(var t=this.gl,e=this.program,r={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var o=t.getActiveAttrib(e,i);o&&(o.typeName=this.getTypeName(o.type),o.length=this.getSize(t,o),o.location=t.getAttribLocation(e,o.name),r[o.name]=o,Object.defineProperty(this,"$"+o.name,{value:o.location,writable:!1,enumerable:!0,configurable:!1}))}return r},t.prototype.getSize=function(t,e){switch(e.type){case t.FLOAT_VEC4:return 4;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC2:return 2;case t.FLOAT:return 1;default:throw Error("[webgl.program:getSize] I don't know the size of the attribute '"+e.name+"' because I don't know the type "+this.getTypeName(e.type)+"!")}},t.prototype.createUniforms=function(){for(var t=this.gl,e=this.program,r={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var o=t.getActiveUniform(e,i);if(o){var a=t.getUniformLocation(e,o.name);a&&(r[o.name]=a,Object.defineProperty(this,"$"+o.name,{set:this.createUniformSetter(o,r[o.name],this._typesNamesLookup),get:this.createUniformGetter(o),enumerable:!0,configurable:!1}))}}return r},t.prototype.createUniformSetter=function(t,e,r){var n=this.gl,i="_$"+t.name;switch(t.type){case n.BYTE:case n.UNSIGNED_BYTE:case n.SHORT:case n.UNSIGNED_SHORT:case n.INT:case n.UNSIGNED_INT:case n.SAMPLER_2D:return 1===t.size?function(t){n.uniform1i(e,t),this[i]=t}:function(t){n.uniform1iv(e,t),this[i]=t};case n.FLOAT:return 1===t.size?function(t){n.uniform1f(e,t),this[i]=t}:function(t){n.uniform1fv(e,t),this[i]=t};case n.FLOAT_VEC2:if(1===t.size)return function(t){n.uniform2fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC2 in uniform `"+t.name+"'!'");case n.FLOAT_VEC3:if(1===t.size)return function(t){n.uniform3fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform `"+t.name+"'!'");case n.FLOAT_VEC4:if(1===t.size)return function(t){n.uniform4fv(e,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform `"+t.name+"'!'");case n.FLOAT_MAT3:if(1===t.size)return function(t){n.uniformMatrix3fv(e,!1,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform `"+t.name+"'!'");case n.FLOAT_MAT4:if(1===t.size)return function(t){n.uniformMatrix4fv(e,!1,t),this[i]=t};throw Error("[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform `"+t.name+"'!'");default:throw Error("[webgl.program.createWriter] Don't know how to deal with uniform `"+t.name+"` of type "+r[t.type]+"!")}},t.prototype.createUniformGetter=function(t){var e="_$"+t.name;return function(){return this[e]}},t}();function a(t,e){return t.split("\n").map((function(t){if("#include"!==t.trim().substr(0,8))return t;var r=t.indexOf("#include")+8,n=t.substr(r).trim();"'<\"".indexOf(n.charAt(0))>-1&&(n=n.substr(1,n.length-2));var i=e[n];if("string"!==typeof i)throw console.error("Include <"+n+"> not found in ",e),Error("Include not found in shader: "+n);return i})).join("\n")}function s(t,e,r){if(t!==e.VERTEX_SHADER&&t!==e.FRAGMENT_SHADER)throw Error("Type must be VERTEX_SHADER or FRAGMENT_SHADER!");var n=e.createShader(t);if(!n)throw Error("Unable to create a "+(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" shader!");if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw console.info("Here is your buggy shader's code:"),console.info(r),console.error("An error occurred compiling the shader: "+e.getShaderInfoLog(n)),Error("Unable to create a "+(t===e.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" shader!");return n}e.default=o},"./src/webgl/resize.ts":function(t,e,r){"use strict";r.r(e),e.default=function(t,e){void 0===e&&(e=0),e<=0&&(e=window.devicePixelRatio);var r=t.canvas,n=Math.floor(r.clientWidth*e),i=Math.floor(r.clientHeight*e);return(r.width!==n||r.height!==i)&&(r.width=n,r.height=i,t.viewport(0,0,n,i),!0)}}})},,,,,,function(t,e,r){"use strict";r.d(e,"a",(function(){return f}));var n=r(3),i=r(4),o=r(6),a=r(5),s=r(7),u=r(0),c=r.n(u),f=(r(12),function(t){function e(){var t,r;Object(n.a)(this,e);for(var i=arguments.length,s=new Array(i),u=0;u<i;u++)s[u]=arguments[u];return(r=Object(o.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(s)))).ref=c.a.createRef(),r}return Object(s.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){var t=this.ref.current;t&&this.props.init(t)}},{key:"render",value:function(){return c.a.createElement("canvas",{ref:this.ref,className:"Canvas"})}}]),e}(c.a.Component))},function(t,e,r){},function(t,e,r){},function(t,e,r){"use strict";r.r(e);var n=r(0),i=r.n(n),o=r(1),a=r.n(o),s=(r(9),r(10),function(){return i.a.createElement("div",{className:"App"},i.a.createElement("h1",null,"Tutorials"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{href:"tuto-clear.html"},"Hello world!")),i.a.createElement("li",null,i.a.createElement("a",{href:"tuto-background.html"},"Scalable background")),i.a.createElement("li",null,i.a.createElement("a",{href:"tuto-sprites-1.html"},"Sprites (1)"))),i.a.createElement("h1",null,"Vanilla Javascipt examples"),i.a.createElement("a",{href:"examples/index.html"},"Look at this page"),".")});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(i.a.createElement(s,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},function(t,e,r){},function(t,e,r){"use strict";var n=r(3),i=r(4),o=r(6),a=r(5),s=r(7),u=r(0),c=r.n(u),f=r(14),l=(r(15),function(t){function e(){return Object(n.a)(this,e),Object(o.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(i.a)(e,[{key:"render",value:function(){return c.a.createElement("div",{className:["view-Description"].join(" ")},c.a.createElement(f.a,{options:{forceBlock:!0}},this.props.content))}}]),e}(c.a.Component));r.d(e,"a",(function(){return l}))},,function(t,e,r){},,,,function(t,e,r){t.exports=r.p+"static/media/background.086dcaef.jpg"},,,,,,,,,function(t,e,r){r(11),t.exports=r(32)},function(t,e,r){},,,function(t,e,r){"use strict";r.r(e);var n=r(0),i=r.n(n),o=r(1),a=r.n(o),s=r(2),u=r.n(s),c=r(8),f=r(13),l=r(19),h=r.n(l),p=(r(29),{start:function(){a.a.render(i.a.createElement("div",null,i.a.createElement(c.a,{init:function(t){var e=new u.a.Scene(t),r=e.createAtlas({image:h.a}),n=new u.a.Painter.Background({atlas:r,align:"BR"});e.use([n]),e.start()}}),i.a.createElement(f.a,{content:'Resize the browser to see how the background adapts.\n\n\n```js\nimport url from "./background.jpg"\n\nconst scene = new FlatLand.Scene(canvas)\nscene.createAtlas({\n    name: "background",\n    image: background\n})\nnew FlatLand.Painter.Background({\n    scene,\n    atlas: "background",\n    align: "BR"\n})\nscene.start()\n```\n'})),document.getElementById("root"))}});r.d(e,"default",(function(){return p}))}],[[28,8,0,1]]]);
//# sourceMappingURL=index.85478ee2.e119a962.chunk.js.map